---
TOCTitle: '企業セキュリティのベスト プラクティス : セキュリティ ベストプラクティス ‐ エンド システムの監視と監査'
Title: '企業セキュリティのベスト プラクティス : セキュリティ ベストプラクティス ‐ エンド システムの監視と監査'
ms:assetid: 'fc6d5f91-b120-4d38-9728-f5100d97278b'
ms:contentKeyID: 19869301
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc750908(v=TechNet.10)'
---

セキュリティ ベストプラクティス
===============================

### エンド システムの監視と監査

最終更新日: 2004年2月2日

**マイクロソフト ソリューション フレームワーク**

**メモ** このホワイトペーパーはシリーズになっています。[企業セキュリティのベストプラクティス](https://technet.microsoft.com/ja-jp/library/300c0dbe-b729-4d42-b172-eb89a280caaa(v=TechNet.10))には、このシリーズのすべての記事がリストされています。[セキュリティ要素構成アーキテクチャ](https://technet.microsoft.com/ja-jp/library/540a3b86-f8f0-49ca-939e-ab7c609c3601(v=TechNet.10))も参照してください。

##### トピック

[](#eiaa)[このドキュメントの目的](#eiaa)
[](#ehaa)[監視の目的](#ehaa)
[](#egaa)[監視のアーキテクチャ](#egaa)
[](#efaa)[イベントの監視](#efaa)
[](#eeaa)[オブジェクトの監視](#eeaa)
[](#edaa)[パフォーマンスの監視](#edaa)
[](#ecaa)[その他の監視](#ecaa)
[](#ebaa)[監視ユーティリティ](#ebaa)
[](#eaaa)[参考資料と関連リンク](#eaaa)

### このドキュメントの目的

どの強力なコンピュータシステムでも、基盤となるのはオペレーティングシステムです。オペレーティングシステムは、個々のコンピュータの用途 (ファイルまたはプリントサーバー、メッセージングまたは Web サーバーなど) に関係なく、アプリケーションを有効にするための基本機能を提供します。このドキュメントでは、インストールされたハードウェアおよびオペレーティングシステムを "ローカルリソース" エンティティと呼びます。

多数のサーバーベンダが、自社製品のハードウェアプラットフォームを監視するための独自の機能や手法を提供しています。したがって、このドキュメントでは、オペレーティングシステム (Microsoft Windows NT 4.0 または Microsoft Windows 2000) 本体に対象を限定します。

[](#mainsection)[ページのトップへ](#mainsection)

### 監視の目的

**目的を果たすには**

監視の一般的な目的は、外部ユーザー、従業員、または誤動作による不審な動作を検知することです。組織では、これを直接行うことも (特定のイベントを監視するなど)、間接的に行うことも (長期間サーバー状態を監視して、異常な動作を調査するなど) できます。

組織のセキュリティ部門は、組織固有の監視ポリシーを決定する必要があります。このポリシーにおいて、組織固有の監視の目的を決定します。これには、以下のような質問に回答する必要があります。

-   サーバーのパフォーマンスのベースラインを設定することが目的ですか ? その場合、どのようなカウンタをどの程度の時間間隔で収集しますか ? どのような頻度でベースラインを設定しますか ?

-   どのオブジェクトを監査しますか ? 各オブジェクトクラスに対し、どのような種類のアクセスを監査しますか ? 各オブジェクトクラスに対し、どのインスタンスを監査しますか ?

-   そのほか、どのような種類のイベントを監査しますか ?

-   イベントログはどのように管理しますか ? マイクロソフトの提供するツールを使用しますか ? それとも独自に作成するか、サードパーティ製システムを購入しますか ?

-   どのような監視技術を使用しますか ?

-   どの程度の量の監視を行いますか ? (システムの監視により、システムパフォーマンスに著しい影響が及びます。システム状態の問い合わせや記録量が多いほど、その動作によって消費されるシステムリソースの量も多くなります)

[](#mainsection)[ページのトップへ](#mainsection)

### 監視のアーキテクチャ

**組み込み機能**

Windows NT 4.0 および Windows 2000 には、監視に使用できるいくつかの組み込み機能があります。

-   イベントログ (監査) - システム自身、およびシステム上の各アプリケーションが、重要なイベントの記録を生成する機能です。

-   パフォーマンスの監視 - システム、およびシステム上の特定のアプリケーションが、パフォーマンス情報を定期的に報告する機能です。

-   SNMP (簡易ネットワーク管理プロトコル) - システムでは SNMP 2 をサポートしています。これは、ネットワークデバイスを監視するための、プラットフォーム非依存の業界標準技術です。

-   WMI (Windows Management Instrumentation) - Windows 2000 には、Windows NT 4.0 にインストール可能な WMI という機能が付属します。WMI は監視サービスではありませんが、他のさまざまな監視機能を統合する、統一管理インターフェイスです。

**イベントログ**

イベントログデータは、システムの他の部分、またはシステム上で動作するアプリケーションによって Event Log サービスに報告されます。Event Log サービスはこのデータを、%systemroot%\\system32\\config ディレクトリ内の .evt ファイルに保存します。Windows NT 4.0 および Windows 2000 Professional には、システムログ、セキュリティログ、およびアプリケーションログが組み込まれています。Windows 2000 Server のインストールにより、DNS (ドメインネームシステム) およびディレクトリサービスのログが追加される場合もあります。イベントのログ記録が必要なすべてのアプリケーションは、Event Log サービスに登録する必要があります。

イベントログに記録される各イベントには、このイベントを説明するテキストデータが表示される説明フィールドがあります。これは通常、エラーメッセージを表すテキストです。ログには通常、イベントの特定インスタンスに固有の情報だけが、イベントと共に保存されます。テキスト文字列は、Event Log サービスに登録されたイベントメッセージファイル (通常は .dll または .exe ファイル) 内に保存されます。イベントを表示する際、イベントテキストが見つからないことを示すエラーが説明フィールドに表示された場合は、イベントを表示しようとしているコンピュータ上で、Event Log サービスにイベントメッセージファイルを登録する必要があります。この詳細については、[http://support.microsoft.com/default.aspx?scid=kb;ja;165959](http://support.microsoft.com/kb/165959) (英語) を参照してください。

イベントログ API (アプリケーションプログラミングインターフェイス) の使用に関する各ドキュメントについては、<http://msdn2.microsoft.com/en-us/library/aa385785.aspx> を参照してください。

**パフォーマンスの監視**

パフォーマンスデータはレジストリ内に保存されますが、通常は PDH (Performance Data Helper) などの API、または WMI を使用してアクセスします。パフォーマンス監視システムのアーキテクチャの詳細については、<http://msdn.microsoft.com/library/te4y11y9.aspx> を参照してください。

**SNMP**

SNMP サービスをインストールすると、SNMP 管理コンソールからの要求に対し、システムが応答できるようになります。また、SNMP サービスをインストールすることで、IP (Internet Protocol)、ICMP (Internet Control Message Protocol)、UDP (User Datagram Protocol)、および TCP (Transmission Control Protocol) に対するパフォーマンスカウンタが追加されます。SNMP を使用すると、多数のローカルリソースの現在の状態を問い合わせることができ、オペレーティングシステムおよびアプリケーション関連のいくつかのパラメータを制御することもできます。

Windows NT および Windows 2000 は、SNMP 管理コンソールを備えていません。したがって、SNMP を効率的に使用するのであれば、サードパーティ製コンソールを用意するか、または社内で何らかのこうしたコンソールを開発することが必要となります。また、マイクロソフトからも、2 つの便利なリソースキットユーティリティを提供しています。コマンドラインによる SNMP クエリユーティリティである SNMPUtil と、一定期間 SNMP カウンタに対してクエリおよびログ記録を実行し、テキストファイルによる設定の可能なコマンドラインユーティリティ SNMPMon です。

**WMI**

WMI (Windows Management Instrumentation) は、マイクロソフトによる WBEM (Web-based Enterprise Management) の実装です。WBEM は業界標準の管理アーキテクチャであり、企業環境において管理情報にアクセスするための、共通インターフェイスの開発を目的としたものです。

WMI には、イベントログ、パフォーマンス、および SNMP に関する情報をシステムに問い合わせる機能があります。また、Windows スクリプトホストと互換性のある任意のスクリプト言語 (Microsoft Visual Basic Scripting Edition (VBScript)、Microsoft JScript など) を使用して、簡単にスクリプト化できます。

WMI の詳細については、<http://msdn.microsoft.com/library/aa394582.aspx> (英語) を参照してください。

Windows NT および Windows 2000 プラットフォームでの WMI および SNMP の実装に関する詳細については、<http://www.microsoft.com/japan/technet/prodtechnol/windows2000serv/maintain/featusability/wmisnmp.mspx> を参照してください。

WMI SDK (ソフトウェア開発キット) には、WMI のサンプルコードが含まれます。これは、[http://www.microsoft.com/downloads/details.aspx?FamilyID=afe41f46-e213-4cbf-9c5b-fbf236e0e875&DisplayLang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=afe41f46-e213-4cbf-9c5b-fbf236e0e875&displaylang=ja) からダウンロードできます。

[](#mainsection)[ページのトップへ](#mainsection)

### イベントの監視

**イベントログの管理**

多くの種類のイベントを収集するようにシステムを構成すると、イベントログはすぐにいっぱいになってしまいます。逆に、ごく小数の種類のイベントだけを記録するように構成すると、重要な情報を見逃してしまう可能性もあります。したがって、何を記録して何を記録しないかは、複雑な判断となります。

ログを記録するイベントのカテゴリを決める際は、生成されるイベントの量、および特定の情報を捕捉するためのユーティリティについて検討することが大切です。最善の方法は、捕捉する情報の種類を正確に決めてから、その情報を収集するために最低限必要な数のイベントを記録する手段を構成する方法です。ログ記録を最大設定にして、やみくもにイベントを記録する方法では、多くの場合、データの量が多すぎて分析または保管しきれないため、大量のデータが無視または破棄されることになります。

Windows NT 4.0 および Windows 2000 には、イベントログの閲覧 (フィルタ処理あり/なし)、保存、および消去を行うための、イベントビューアというユーティリティが付属しています。管理者はこのユーティリティを使用することで、ログが満杯になった場合、新規イベントによって古いイベントを上書きするかどうかを制御でき、イベントログの最大サイズを制限することもできます。Windows NT 4.0 および Windows 2000 のどちらにも、イベントログを中央から一元的に収集および管理するための機能は備わっていませんが、このようなユーティリティは、さまざまなサードパーティベンダから提供されています。

イベントログの管理は、企業の監視における最も重要な側面の 1 つです。システムレベルでは、イベントビューアなどのユーティリティでも、イベント監視の全体的な必要性に十分対応できるかもしれません。しかし、企業内の多数のコンピュータを監視するとなると、収集されるデータの量は通常、管理者の管理能力をはるかに超えてしまいます。したがって、一般的には、データを一元的に収集する何らかの機能が必要となります。

**推奨 :** 集中管理型のイベントログ管理システムは、企業に適したものを比較購入してください。各種のパッケージを評価する際は、各パッケージに対し、イベント収集システムの拡張性と機能、およびクエリ機能とレポート機能の品質の両面を考慮します。使いにくい分析ツールだと、イベントログデータを大量に収集しても役に立ちません。

イベントログ管理のもう 1 つの重要な面は、各イベントログに対し、サイズ、場所、および上書きポリシーを管理することです。

各ログには、いくつかの設定可能なパラメータが存在します。

-   ログファイルの場所と名前。これは各ログごとに個別に、次のキー内で、**File**という名前の REG\_EXPAND\_SZ 型の値に保管されます。

    **HKLM\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\&lt; ログ名 &gt;**

-   ログファイルの最大サイズ。これはイベントビューアアプリケーションで設定可能であり、既定値は 512 KB です。

-   ログが満杯になったときの上書き方法。必要に応じてイベントを上書きする、特定の日数より以前のイベントを上書きする、上書きしない、という 3 つの選択肢があります。特定の日数より以前のイベントだけを上書きする場合は、この日数を独自に設定できます。

-   ゲストアクセスの制限 (Windows 2000 のみ)。このパラメータを指定すると、許可されたユーザーだけがイベントログにアクセスできるようになります。

また、システム全体に適用される **CrashOnAuditFail**, というパラメータもあります。このパラメータを設定すると、セキュリティログが満杯になった時点でシステムが停止します。通常は、**CrashOnAuditFail**の設定は望ましくありません。詳細については、次の URL の『セキュリティ ログがフル Auditable 活動のようにする方法』を参照してください。<http://support.microsoft.com/kb/140058>

**CrashOnAuditFail**を使用する場合は、監査ログの各項目を慎重に設定する必要があります。このドキュメントの作成時点では、この設定に関し、"セキュリティログがいっぱいになると STOP 0xC0000244 が表示される" という、少なくとも 1 つの大きな問題が認められています。詳細については[http://support.microsoft.com/default.aspx?scid=kb;ja;232564](http://support.microsoft.com/kb/232564) を参照してください。

**イベントの分析**

イベントログ内の各イベントは、以下のフィールドで構成されます。

-   日付と時刻

-   種類 - イベントの重要度

-   ソース - イベントを記録したコンポーネント

-   カテゴリ - セキュリティイベントの詳細な分類

-   イベント ID - 発生したイベントを一意に識別する数値

-   ユーザー - イベントに関連するユーザーの名前 (存在する場合)

-   コンピュータ - イベントが記録されたコンピュータ

-   説明 - イベントに関連付けられたテキストデータ (エラーメッセージなど)

-   データ - イベントに関連付けられたバイナリデータ

これらの中で、注目すべき非常に重要なフィールドは、イベント ID と説明テキストです。イベント ID は、マイクロソフトのサポート技術情報内でこのイベントについて調べるための、最も簡単な手段として使用できます。説明テキストでは通常、発生した問題が簡単な表現で説明されています。また、説明フィールドには多くの場合、特定のイベント、特にセキュリティ関連のイベントに固有の情報も記述されています。マイクロソフト製品以外のイベント収集ツールを使用して、イベントを中央データベースに収集する場合は、すべてのセキュリティイベントに対し、説明フィールドが収集されるように設定してください。

イベントの構造の詳細については、次の URL の[「Elements of an Event Record」](http://technet.microsoft.com/library/cc749970.aspx)を参照してください。<http://technet.microsoft.com/library/cc749970.aspx> (英語)

**システムを監視する**

**一般的なシステムを監視する**

原則的に、"システム" カテゴリでは、成功および失敗イベントの両方を監査することをお勧めします。

Windows ではこのカテゴリを使用して、システム全体のセキュリティに影響を与える以下のイベントを記録します。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>512</code></pre></td>
<td style="border:1px solid black;"><pre><code>Windows NT を起動しています。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>513</code></pre></td>
<td style="border:1px solid black;"><pre><code>Windows NT をシャットダウンしています。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>514</code></pre></td>
<td style="border:1px solid black;"><pre><code>ローカル セキュリティ機関によって、認証パッケージが読み込まれました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>515</code></pre></td>
<td style="border:1px solid black;"><pre><code>信頼されているログオン プロセスがローカル セキュリティ機関に
登録されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>516</code></pre></td>
<td style="border:1px solid black;"><pre><code>監査メッセージをキューに登録するために割り当てられた
内部リソースをすべて使用したため、一部の監査が失われました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>517</code></pre></td>
<td style="border:1px solid black;"><pre><code>監査ログが消去されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>518</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティ アカウント マネージャによって、
通知パッケージが読み込まれました。</code></pre></td>
</tr>
</tbody>
</table>
 

これらのイベントに何らかの異常が見られた場合は、パスワード傍受プログラム、または安全性の保証されない無許可の認証プログラムのロードが、何者かによって試行されている可能性があります。

**監査ポリシーを監視する**

Windows NT または Windows 2000 システムのローカルセキュリティ機関 (LSA) は、システムのさまざまなセキュリティ関連タスクを実行します。また、システムのセキュリティポリシー (ローカルコンピュータが適用対象となる、Microsoftｮ Active Directory" のサイト、ドメイン、および組織単位のポリシーを含む) が確実に実施されるための責任を持ちます。システムを監視する際、特に注意の必要な主要なポリシーの 1 つが、監査ポリシーです。

監査ポリシーは、Windows NT 4.0 ではユーザーマネージャで操作します。Windows 2000 が動作するコンピュータでは、グループポリシー内で操作します。これを実行するには、**\[スタート\]** メニューの **\[管理ツール\]** メニューから、**\[ローカルセキュリティポリシー\]** を選択します。監査ポリシーは、ツリー構造内の**ローカル ポリシー \\ 監査ポリシー**に保管されています。グループポリシーは、**\[Active Directory ユーザーとコンピュータ\]** スナップインで、適切なオブジェクトのプロパティシートから、ドメインまたは組織単位に対して設定することができます。また、**\[Active Directory サイトとサービス\]** スナップインで、適切なサイトのプロパティシートから、サイトに対して設定することもできます。

不正を企む管理者が、いったん監査を無効にし、禁止された行為を実行してから監査を有効に戻す事態を防止するには、監査ポリシーの監視がきわめて重要です。

ポリシーの変更の成功および失敗に対する監査を有効にすると、以下のイベントが有効になります (ほとんどのイベントは Windows 2000 のみで有効)。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>608</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー権利が割り当てられました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>609</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー権利が削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>610</code></pre></td>
<td style="border:1px solid black;"><pre><code>他のドメインとの信頼関係が作成されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>611</code></pre></td>
<td style="border:1px solid black;"><pre><code>他のドメインとの信頼関係が削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>612</code></pre></td>
<td style="border:1px solid black;"><pre><code>監査ポリシーが変更されました。</code></pre></td>
</tr>
</tbody>
</table>
  
<codesnippet language displaylanguage containsmarkup="false"> Windows 2000 のみ :   
```
 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>613</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec ポリシー エージェントが開始されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>614</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec ポリシー エージェントが無効になりました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>615</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec ポリシーが変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>616</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec ポリシー エージェントにより、
重大である可能性のある障害が検出されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>617</code></pre></td>
<td style="border:1px solid black;"><pre><code>Kerberos ポリシーが変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>618</code></pre></td>
<td style="border:1px solid black;"><pre><code>暗号化されたデータの回復ポリシーが変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>619</code></pre></td>
<td style="border:1px solid black;"><pre><code>サービス ポリシーの品質が変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>620</code></pre></td>
<td style="border:1px solid black;"><pre><code>他のドメインとの信頼関係が変更されました。</code></pre></td>
</tr>
</tbody>
</table>
  
ほとんどのセキュリティイベントと同様、各イベントに固有の注目すべき情報は (変更されたポリシーの種類やその変更者など)、各イベントの説明フィールドに格納されます。
  
**注** Windows NT および Windows 2000 では、管理者によるアクションを制御できません。管理者による行為は、ほぼすべてが監視可能です。しかし、管理者はシステムコンポーネントを置き換えたりシステムのセキュリティポリシーとログを操作したりする権限を持っているため、意図的に監査を回避したり、少なくとも自分の痕跡を消すことはできます。管理者のアクセス権は、信頼のおける人物だけに許可するようにしてください。
  
**推奨** ポリシー変更カテゴリでは、常に成功および失敗イベントの両方を監査してください。
  
監査ポリシーの詳細については、以下を参照してください。 『Policy\_Audit\_Event\_Type』 (英語)  
<http://msdn.microsoft.com/library/ms721901.aspx>
  
セキュリティ イベントを監査する  
[http://technet.microsoft.com/library/cc776394.aspx](http://technet.microsoft.com/library/cc776394)
  
監査ポリシー、レジストリから確認する方法  
<http://support.microsoft.com/kb/246120>
  
**アップタイムと再起動を監視する**
  
Event Log サービスを開始すると (このサービスが、コンピュータの起動時に開始される最初のサービスの 1 つである場合)、システムログ内にイベント 6005 が生成されます。管理者がシステムをシャットダウンした場合など、Event Log サービスが正常にシャットダウンされると、イベント 6006 が記録されます。システムが予想外に再起動されると、イベント 6008 が記録されます。これらのイベントは自動的にログ記録されるので、このログ記録を有効にするための設定は不要です。また、Event Log サービスを無効にしない限り、これらのイベントログを無効にすることはできません。
  
こうしたイベントを収集して相互に関連付け、システム可用性に関する有用なレポートを作成するための最も簡単な方法は、マイクロソフトの Web サイトから入手可能な Uptime.exe ユーティリティを使用することです。
  
Event Log サービスにおいて、情報を提供する各イベントの詳細については、<http://support.microsoft.com/kb/196452> を参照してください。
  
Uptime.exe ユーティリティの詳細については、<http://support.microsoft.com/kb/232243> (英語) を参照してください。
  
**クラッシュを監視する**
  
Windows NT 4.0 および Windows 2000 は、カーネルモードでの致命的な例外 (Stop エラー) が発生したときに、イベントログにイベントが書き込まれるように構成できます。Windows 2000 Professional および Windows NT 4.0 Workstation は、既定ではイベントを生成しませんが、サーバー製品はイベントを生成するように構成されています。
  
このとき生成されるイベントの ID は 1001 となり、イベントソースには "Save Dump" と記録されます。
  
Stop エラーに対するイベントの生成を有効または無効にするには、システムのコントロールパネルの回復設定セクションで、**\[システムログにイベントを書き込む\]** チェックボックスのオン/オフを切り替えるか、またはレジストリで設定します。詳細については、次のマイクロソフトサポート技術情報<http://support.microsoft.com/kb/235496> を参照してください。
  
**ハードウェア障害を監視する**
  
ハードウェアコンポーネントのドライバは通常、障害を自動的にログに記録します。このドキュメントの趣旨から外れるため、ここではこうしたイベントすべてはリストしませんが、このようなクラスのイベントは通常、次の 2 つの共通の性質を持ちます。
  
-   これらのイベントに対するイベントソースは、ドライバ名となります。
  
-   これらのイベントに対するイベントカテゴリは、深刻度の低い、または回復可能な障害の場合は "警告" となり、深刻な、または回復不可能な障害の場合は "エラー" となります。
  
これらのイベントは、その他の症状が何も見られない状態で繰り返し発生する場合であっても、無視するべきではありせん。これらのイベントを調べるには、ハードウェアベンダの Web サイトでサポート情報を参照するか、マイクロソフトサポート技術情報 <http://support.microsoft.com/default.aspx> を参照してください。
  
通常は、このような種類のイベントのログ記録を構成する手段はありません (ごく一部のベンダに限り、こうした手段を提供しています)。
  
**推奨** ハードウェア関連の警告およびエラーイベントは、常に中央のイベント収集システムに報告し、それぞれのイベントを検証する必要があります。
  
**プロセスを監視する**
  
Windows NT および Windows 2000 には、システムでの各プロセスの作成および破棄をログ記録する機能があります。この機能を有効にするには、"詳細な追跡" カテゴリの成功および失敗イベントを監査するように、システムの監査ポリシーを設定します。
  
プロセスが作成されると、このプロセスにはプロセス ID (PID) が割り当てられます。これは、プロセスがアクティブとなる期間中、このプロセスに対して一意となる数値です。PID は、他の多数のセキュリティ関連イベントによって参照されます。また、他のイベントが生成された時点で、あるユーザーが実行していた処理を判別するために使用しても便利です。
  
他の多くのセキュリティイベントと同様、詳細な追跡イベントのログ記録を行うと、大量のイベントが生成される可能性があります。特に、CGI (Common Gateway Interface) を多用する Web サーバーなど、大量のプロセスを開始するユーザーワークステーションおよびサーバーでは、この傾向が顕著です。
  
詳細な追跡の成功または失敗の監査を有効にすると、以下のイベントが有効になります。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>592</code></pre></td>
<td style="border:1px solid black;"><pre><code>新規プロセスが作成されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>593</code></pre></td>
<td style="border:1px solid black;"><pre><code>プロセスが終了しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>594</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトのハンドルが複製されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>595</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトへの間接アクセスが取得されました。</code></pre></td>
</tr>
</tbody>
</table>
  
これらのイベントの説明フィールドには、PID などの役立つ情報が記録されます。
  
このカテゴリのイベントを監視する場合の難点は、これらのイベントが単独ではほとんど役に立たず、イベント数も大量になることです。したがって、詳細追跡イベントを、オブジェクトアクセスイベントなどの他のイベントに関連付けるために、かなり高度な分析ツールが必要となります。逆に利点は、ユーザーが実行した処理の詳細を知る手がかりを得られることです。
  
**アプリケーションを監視する**
  
アプリケーションは通常、重要なイベントをアプリケーションイベントログに記録します。ただし、一部のアプリケーションは、アプリケーション固有のログファイルにログを記録します。この節の趣旨から外れるため、ここではアプリケーションの監視について詳細に解説することは省略しますが、この場合も、一般的なガイドラインを同様に適用できます。つまり、常にエラーイベントを検証し、ログの設定を決定する際は、要件を満たすために最低限必要な量の情報だけを記録するように設定することです。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### オブジェクトの監視
  
**はじめに**
  
Windows NT および Windows 2000 では、ファイル、ディレクトリ、レジストリキー、ディレクトリサービスオブジェクト、カーネルオブジェクトといった、特定のオブジェクトに対するアクセスを監視できます。
  
監査はオブジェクトごと、およびアクセスごとに実行されます。したがって、どのオブジェクトを監査するか、およびこれらのオブジェクトに対するどのようなアクセスを監査するかを指定します。監査できるアクセスの種類は、オブジェクトの種類によって異なり、このオブジェクトクラスに割り当てることができるアクセス許可に対応します。
  
他のクラスのイベント監視と同様、対象を限定した方法によって、オブジェクトへのアクセスを監視することが非常に重要です。監査を計画する際は、最低限監査の必要な数と種類のオブジェクトを決定してから、監査対象オブジェクトのそれぞれの種類に対し、最低限監視の必要な数のアクセスを決定します。必要以上に範囲を広げて監査を行うと、システムのパフォーマンスに深刻な影響が及び、必要以上、または多すぎて役に立たないほどの大量のデータを収集してしまうことになります。
  
監査が実行されるのは、オブジェクトハンドルが取得または解放されたときです。実行される監査の種類は、実際に行われたアクションではなく、要求された (実際に許可された) アクセスの種類によって決まります。たとえば、ファイルが実際に変更されていない場合でも、このファイルオブジェクトに対して "書き込み" 監査が実行されることも珍しくありません。マイクロソフトではこの動作について調査を進めており、Windows 2000 の将来バージョンでは、これは修正される見込みです。
  
監査ポリシーの "ファイルおよびオブジェクトアクセス" カテゴリに対し、成功および失敗の監査を有効にすると、以下のイベントを有効にできます (ただしこの場合であっても、監視対象の個々のファイルまたはオブジェクトに対し、必要な監査を設定する必要があります)。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>560</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトが開かれました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>561</code></pre></td>
<td style="border:1px solid black;"><pre><code>ハンドルが割り当てられました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>562</code></pre></td>
<td style="border:1px solid black;"><pre><code>ハンドルが閉じられました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>563</code></pre></td>
<td style="border:1px solid black;"><pre><code>削除目的でオブジェクトが開かれました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>564</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトが削除されました。</code></pre></td>
</tr>
</tbody>
</table>
  
<codesnippet language displaylanguage containsmarkup="false"> Windows 2000 のみ :   
```
 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>565</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトが開かれました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>566</code></pre></td>
<td style="border:1px solid black;"><pre><code>オブジェクトの操作が実行されました。</code></pre></td>
</tr>
</tbody>
</table>
  
**監視が可能なオブジェクト**
  
監視が可能なオブジェクトには、いくつかの種類があります。各種のオブジェクトには、それぞれに固有のアクセスの種類があります。つまり、各種のオブジェクトはそれぞれ、その種類のオブジェクトだけに適した方法によってアクセスされます。たとえば、サービスに対しては "開始" および "停止" アクセスが適しますが、これらのアクセスは、ファイルやディレクトリに対してはあまり意味をなしません。
  
また、いくつかの標準的な種類のアクセスは、全オブジェクトに適用されます。これらの標準的なアクセス許可は、オブジェクトのセキュリティ設定に関するものです。標準的なアクセス許可には、WRITE\_DAC (アクセス許可の変更)、WRITE\_OWNER (所有者の変更)、READ\_CONTROL (セキュリティ情報の読み取り)、および DELETE (オブジェクトの削除) があります。標準的なアクセス許可の詳細については、<http://msdn.microsoft.com/library/aa379607.aspx> を参照してください。
  
オブジェクトへのアクセスをセキュリティ保護または要求する場合には、アクセスマスクを使用します。アクセスマスクはビットマスク値であり、マスク内の個々のビットは、オブジェクトへの特定のアクセスを表します。これにより、必要なデータ構造が大幅に縮小され、素速く操作できるようになります。
  
以下に、監査可能な最も一般的なオブジェクトを示します。
  
-   ファイルとディレクトリ - 監査可能な最も一般的なオブジェクトは、ファイルおよびディレクトリオブジェクトです。ファイル固有のアクセス許可のリストについては、<http://msdn.microsoft.com/library/aa364399.aspx> (英語) を参照してください。
  
-   レジストリキー - 次に一般的な監査可能オブジェクトです。レジストリ固有のアクセス許可のリストについては、<http://msdn.microsoft.com/library/ms724878.aspx> (英語) を参照してください。
  
-   サービス - Windows NT および Windows 2000 の各サービスは、他のオブジェクトと同様にセキュリティ保護および監査が可能なオブジェクトです。サービス固有のアクセス許可のリストについては、<http://msdn.microsoft.com/library/ms685141.aspx> (英語) を参照してください。
  
-   カーネルオブジェクト - ミューテックスやセマフォなどのカーネルオブジェクトも、監査が可能です。生成される監査結果は、通常、開発者以外には意味のないものです。カーネルオブジェクトの監査を有効にするには、Windows 2000 セキュリティポリシーの **\[グローバルシステムオブジェクトへのアクセスを監査する\]** 設定を有効にします。または、Windows NT 4.0 または Windows 2000 で、以下のレジストリ値を設定します。**HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\AuditBaseObjects** (REG\_DWORD) = **0x00000001**
  
-   ディレクトリサービスオブジェクト - ディレクトリサービスオブジェクトに固有のアクセス許可のリストについては、<http://msdn.microsoft.com/library/aa772172.aspx> (英語) を参照してください。
  
-   プリンタ - プリンタ固有のアクセス許可のリストについては、<http://msdn.microsoft.com/library/ms535673.aspx> (英語) を参照してください。
  
監査可能なオブジェクトの完全リストについては、[http://msdn.microsoft.com/library/aa375657.asp](http://msdn.microsoft.com/library/aa375657.aspx) (英語) を参照してください。
  
アクセスマスクの詳細については、以下を参照してください。
  
-   <http://msdn.microsoft.com/library/aa374902.aspx> (英語)
  
-   <http://msdn.microsoft.com/library/ms790780.aspx> (英語)
  
**オブジェクト監査のアーキテクチャ**
  
このドキュメントで、アクセス許可についてなぜここまで詳しく掘り下げる必要があるのでしょうか。その理由は、アクセス許可または監査の設定によってオブジェクトをセキュリティ保護する場合、許可または禁止するアクセス許可、あるいは監査対象のアクセス許可を指定しなければならないためです。ここでは、オブジェクトセキュリティの内部動作の仕組みを、監査に焦点を当てて説明します。
  
**セキュリティ記述子**
  
Windows NT および Windows 2000 において、セキュリティ保護の可能なすべてのオブジェクトには、セキュリティ記述子と呼ぶデータ構造が関連付けられています。セキュリティ記述子には、オブジェクトに関する以下の 4 種類の情報が記述されています。
  
-   オブジェクトの所有者
  
-   オブジェクトのグループ。これは POSIX 形式のセキュリティに使用されます。
  
-   オブジェクトの随意アクセス制御リスト (DACL)。これは、オブジェクトを表示または操作するためのアクセス許可を持つユーザーおよびグループのリスト、またはオブジェクトへのアクセスを拒否されたユーザーおよびグループのリストです。
  
-   オブジェクトのシステムアクセス制御リスト (SACL)。これは、このオブジェクトに対するアクションが監査されるユーザーおよびグループのリストです。
  
監査に関しては、この中で最も注目すべき情報は SACL です。
  
SACL は、アクセス制御エントリ (ACE) の単純なリストです。個々の ACE には、以下の 3 種類の情報が記述されています。
  
-   監査対象のユーザーまたはグループ
  
-   監査対象となる特定のアクセスの種類 (アクセスマスク)
  
-   成功したアクセス、または失敗したアクセスのどちらを監査するのかを示すフラグ
  
たとえば、次のような SACL を持つファイルオブジェクトがあるとします。

 
<table style="border:1px solid black;">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;">Everyone</td>
<td style="border:1px solid black;">Success</td>
<td style="border:1px solid black;">WRITE_DAC</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">Everyone</td>
<td style="border:1px solid black;">Failure</td>
<td style="border:1px solid black;">(All)</td>
</tr>
</tbody>
</table>
  
これは、ごく単純な SACL です。この SACL では、"Everyone" グループのいずれかのメンバがファイルに対するアクセス許可を変更すると、イベントが生成されることを定義しています。2 番目のエントリでは、誰かが何らかの目的でファイルにアクセスしようとして、必要なアクセス許可がないためアクセスに失敗すると、イベントが生成されることを定義しています。
  
DACL と SACL の詳細については、<http://msdn.microsoft.com/library/aa379321.aspx> (英語) を参照してください。
  
**ハンドル**
  
Windows NT および Windows 2000 の監査は、オブジェクトのハンドルが解放されたときに実行されます。
  
Windows NT および Windows 2000 には、カーネルモードのセキュリティサブシステムがあります。つまり、オブジェクトへのアクセスを試みるプログラムは、カーネルを経由しないとオブジェクトにアクセスできず、セキュリティシステムを回避できません。カーネルのメモリ空間は、ユーザーモードのプログラムからは隔離されているため、プログラムは、ハンドルと呼ばれるデータ構造を介してオブジェクトを参照します。一般的なアクセスの試行は、次のように行われます。
  
1.  ユーザーがプログラムに対し、オブジェクトへのアクセスを指示します (**\[ファイル\]** メニューから **\[開く\]** を選択するなど)。
  
2.  プログラムはシステムに対し、アクセスの種類 (読み取り、書き込みなど) を指定して、オブジェクトのハンドルを要求します。
  
3.  セキュリティサブシステムは、要求されたオブジェクトの DACL を、ユーザーのトークンと比較します。これには DACL 内で、ユーザー、またはユーザーが属するグループと一致するエントリを探し、プログラムから要求されたアクセスがこのエントリに許可されているかどうかを確認します。
  
4.  次に、要求されたオブジェクトの SACL を、ユーザーのトークンと比較します。これには、SACL 内で、プログラムに返される有効な権限、またはプログラムによって要求された権限と一致するエントリを探します。一致の失敗監査 ACE が、要求されたが許可されていないアクセスと一致する場合は、失敗監査イベントが生成されます。一致の成功監査 ACE が、許可されたアクセスと一致する場合は、成功監査イベントが生成されます。
  
5.  何らかのアクセスが許可されている場合は、システムはプログラムにオブジェクトハンドルを返します。プログラムはこのハンドルを使用して、オブジェクトにアクセスできます。
  
ここで非常に重要なのは、監査が実行されてイベントが生成された時点では、オブジェクトにはまだ何の処理も行われないということです。これは、監査イベントを解釈する上で重要です。書き込み監査は、ファイルへの書き込みが行われる前に実行され、読み取り監査は、ファイルの読み取りが行われる前に実行されます。
  
なぜこれが重要なのでしょうか。その理由は、プログラムの実際の目的とは関係なく、1 つのオブジェクトに対するすべてのアクセスを要求することが、プログラミングにおける一般的な慣例となっているためです。プログラマが、すべてのアクセスが許可されたハンドルを取得し (このとき、何らかのアクセスが監査された場合に限り、監査イベントが生成されます)、最小限のアクセスしか実行せずにハンドルを閉じることを、阻止する手段はありません。たとえば、ファイルに対するアクセス許可の変更 (WRITE\_DAC アクセス) を、誰にも実行させないための監査戦略を立てたとします。
  
1.  管理者は、ファイルの SACL を「Everyone::Success::Write\_DAC」と設定します。
  
2.  プログラムが、すべてのアクセスを指定してファイルを開くと、WRITE\_DAC 監査イベントが発生します。
  
3.  プログラムはこのファイルに対し、変更は加えずに読み取りだけを行います。
  
4.  プログラムがファイルを終了します。
  
セキュリティ管理者としてここで注意したいのは、ユーザーは実際には何も行っていないにもかかわらず、監査ログには、ユーザーがファイルに対するアクセス許可を変更したと記録されることです。
  
この問題に、どのように対処したらよいでしょうか。現時点では、対策は何もありません。重要な点は、監査はオブジェクトの操作に基づいて行われるのではなく、ハンドルの操作に基づいて行われることです。監査イベントの内容は間違いではありません。その本当の意味を理解しなければならないだけです。これも、最小限度の、対象を限定した監査を実行しなければならないもう 1 つの理由です。オブジェクトにアクセスするプログラムを記述する場合は、望ましいプログラミング手法として、使用するアクセス許可だけを要求することをお勧めします。
  
**継承**
  
アクセス許可および監査の設定は、親コンテナから継承できます。セキュリティ設定の継承に関する詳細については、<http://support.microsoft.com/kb/220167> を参照してください。
  
**オブジェクトの監査設定を変更する**
  
SACL は、オブジェクトのセキュリティダイアログの、高度なプロパティダイアログから操作します。セキュリティダイアログにアクセスするには、オブジェクトを右クリックしてオブジェクトのプロパティシートを開き、**\[セキュリティ\]** タブを選択します。
  
ファイルとディレクトリ、レジストリキー、およびサービスに対する監査は、グループポリシーで設定できます。これには、**\[Active Directory ユーザーとコンピュータ\]** スナップインを使用して、ポリシーを設定するコンテナの **\[グループポリシー\]** プロパティシートを開きます。ポリシーを編集するときに、**\[コンピュータの構成\]**、**\[Windows の設定\]**、**\[セキュリティの設定\]** の順に移動します。**\[ファイルシステム\]**、**\[レジストリ\]**、および **\[システムサービス\]** の各セクションで、各オブジェクトに対するアクセス許可および監査を指定できます。
  
**ユーザーの動作を監視する**
  
**ログオンを監視する**
  
Windows NT および Windows 2000 では、ログオン操作を詳細に監視できます。これには、システムの監査ポリシーの "ログオン" カテゴリの各動作に対し、成功および失敗の監査を有効にします。これにより、成功または失敗 (または両方) のいずれを監査するかに応じて、以下のイベントが発生します。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>528</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが成功しました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>529</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : ユーザー名を認識できないか、パスワードが間違っています。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>530</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : アカウントによるログオンが可能な時間の制限に違反しています。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>531</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : アカウントが現在無効です。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>532</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : 指定したユーザー アカウントの有効期限が切れています。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>533</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : このコンピュータへのログオンがユーザーに許可されていません。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>534</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : このコンピュータでは、要求されたログオンの種類が
ユーザーに許可されていません。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>535</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : 指定したアカウントのパスワードの有効期限が切れています。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>536</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : NetLogon コンポーネントがアクティブではありません。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>537</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : ログオン中に予想外のエラーが発生しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>538</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザーがログオフしました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>539</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンが失敗しました。
理由 : アカウントがロックアウトされています。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>540</code></pre></td>
<td style="border:1px solid black;"><pre><code>ネットワーク ログオンが成功しました。</code></pre></td>
</tr>
</tbody>
</table>
  
<codesnippet language displaylanguage containsmarkup="false"> Windows 2000 のみ :   
```
 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>541</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec セキュリティ アソシエーションが確立されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>542</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec セキュリティ アソシエーションが終了しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>モード : </code></pre></td>
<td style="border:1px solid black;"><pre><code>データ保護 (クイック モード)</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>543</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec セキュリティ アソシエーションが終了しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>モード : </code></pre></td>
<td style="border:1px solid black;"><pre><code>キー交換 (メイン モード)</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>544</code></pre></td>
<td style="border:1px solid black;"><pre><code>ピアが認証できなかったため、IPSec セキュリティ 
アソシエーションの確立に失敗しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>545</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec ピアの認証に失敗しました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>546</code></pre></td>
<td style="border:1px solid black;"><pre><code>ピアから送信された提案が無効であるため、
IPSec セキュリティ アソシエーションの確立に失敗しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>547</code></pre></td>
<td style="border:1px solid black;"><pre><code>IPSec セキュリティ アソシエーションの
ネゴシエーションに失敗しました。</code></pre></td>
</tr>
</tbody>
</table>
 

これらの各イベントには、それぞれのログオンについての詳細情報を示す説明テキストが記録されます。

また、Windows 2000 では、"アカウントログオン" カテゴリの成功および失敗監査を有効にできます。これにより、以下のイベントが有効になります。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>672</code></pre></td>
<td style="border:1px solid black;"><pre><code>認証チケットが付与されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>673</code></pre></td>
<td style="border:1px solid black;"><pre><code>サービス チケットが付与されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>674</code></pre></td>
<td style="border:1px solid black;"><pre><code>付与されたチケットが更新されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>675</code></pre></td>
<td style="border:1px solid black;"><pre><code>事前認証に失敗しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>676</code></pre></td>
<td style="border:1px solid black;"><pre><code>認証チケットの要求が失敗しました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>677</code></pre></td>
<td style="border:1px solid black;"><pre><code>サービス チケットの要求が失敗しました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>678</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンのためにアカウントがマップされました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>679</code></pre></td>
<td style="border:1px solid black;"><pre><code>ログオンのためにアカウントをマップできませんでした。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>680</code></pre></td>
<td style="border:1px solid black;"><pre><code>アカウントがログオンに使用されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>681</code></pre></td>
<td style="border:1px solid black;"><pre><code>&lt;ワークステーション&gt; の &lt;ソース&gt; によるアカウント 
&lt;クライアント名&gt; へのログインが失敗しました。
エラー コードは &lt;エラー&gt; です。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>682</code></pre></td>
<td style="border:1px solid black;"><pre><code>セッションが winstation に再接続されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>683</code></pre></td>
<td style="border:1px solid black;"><pre><code>セッションが winstation から切断されました。</code></pre></td>
</tr>
</tbody>
</table>
  
ログオンを監視するための最も大きな理由の 1 つは、アカウントロックアウトイベントを捕捉することです。適切にセキュリティ保護されたすべてのサイトには、アカウントロックアウトポリシーが設定されており、すべてのアカウントロックアウトイベントは有効な意味を持ちます。ヘルプデスクではこの情報を使用して、ユーザーが自身をロックアウトしてしまう頻度について統計を取ることができ、社内のセキュリティチームでは、潜在的なパスワード推測攻撃を監視できます。アカウントロックアウトイベントは、ローカルコンピュータ上と、認証を行うドメインコントローラ上の両方に保管されます。このため、ロックアウトされたアカウントを識別するには、複数のドメインコントローラからのイベントログを相関付けることがしばしば必要となります。詳細については、次の URL の『\[NT\] アカウント ロックアウト イベントの入手方法』を参照してください。  
[http://support.microsoft.com/default.aspx?scid=kb;ja;182918](http://support.microsoft.com/kb/182918)
  
ユーザーログオンの監査の詳細については、次の URL の『\[NT\] ユーザー認証の監査』を参照してください。  
[http://support.microsoft.com/default.aspx?scid=kb;ja;174073](http://support.microsoft.com/kb/174073)
  
ログオンが監査されていないように見える特定の事例については、次の URL の『Event Viewer Does Not Show IUSR\_machinename Account Logon』を参照してください。[http://support.microsoft.com/default.aspx?scid=kb;ja;188903](http://support.microsoft.com/kb/188903) (英語)
  
**ユーザー権利の使用状況を監視する**
  
Windows NT および Windows 2000 には、ユーザー権利 (特権とも呼ぶ) の使用状況を監査する機能があります。この設定は、有効にすることも無効にすることもできますが、監査対象の権利を選択することはできません。すべて監査するか、何も監査しないかのどちらかになります。ユーザー権利の使用状況の監査を有効にすると、大量の監査が実行されます。ほとんどの場合、これらのイベントが提供する情報は、管理の目的でさほど重要ではありません。
  
"ユーザー権利の使用" カテゴリに対して成功および失敗監査を有効にすると、以下のイベントが有効になります。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>576</code></pre></td>
<td style="border:1px solid black;"><pre><code>新規ログインに特殊な特権が割り当てられました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>577</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザーが特権を持つサービスが呼び出されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>578</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザーが特権を持つオブジェクトの操作が実行されました。</code></pre></td>
</tr>
</tbody>
</table>
  
**推奨** ユーザー権利の使用状況の監査は、環境にとってどうしても必要でない限り、実行しないでください。ユーザー権利の使用状況を監査しなければならない場合は、必要なユーザー権利だけをフィルタ処理できるイベント分析ツールを別途購入するか、独自に作成することをお勧めします。
  
システムの監査ポリシーで "ユーザー権利の使用" カテゴリを有効にしている場合でも、すべてのユーザー権利が監査されるわけではありません。しかし、これらのイベントを監査することで、あまり重要でない、あるいはまったく無意味なイベントによって、イベントログがすぐに満杯になってしまいます。
  
以下のユーザー権利は、どのような場合においても監査されません。
  
-   スキャンチェックの回避 (SeChangeNotifyPrivilege)
  
-   セキュリティ監査の生成 (SeAuditPrivilege)
  
-   トークンオブジェクトの作成 (SeCreateTokenPrivilege)
  
-   プログラムのデバッグ (SeDebugPrivilege)
  
-   プロセスレベルトークンの置き換え (SeAssignPrimaryTokenPrivilege)
  
以下のユーザー権利は、特定のレジストリ設定が存在する場合に限り監査されます。
  
-   ファイルおよびディレクトリのバックアップ (SeBackupPrivilege)
  
-   ファイルおよびディレクトリの復元 (SeRestorePrivilege)
  
バックアップおよび復元特権の監査を有効にするためのレジストリ値は、**HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\FullPrivilegeAuditing** (REG\_DWORD) です。監査を有効にするには、値を 1 に設定します。この設定は、Windows 2000 のセキュリティポリシーユーザーインターフェイスから設定することもできます。
  
ユーザー権利の監査の詳細については、次の URL の『ユーザーの正しい割り当て Changes を監査』を参照してください。<http://support.microsoft.com/kb/163905> (英語)
  
**管理権限を監視する**
  
**アカウント管理を監視する**
  
Windows 2000、および Windows NT 4.0 の最新のいくつかの Service Pack では、"アカウント管理" 監査ポリシーをきめ細かく設定できます。このイベントカテゴリに対して成功または失敗の監査を行うと、以下のイベントが有効になります。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>624</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントが作成されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>625</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントの種類が変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>626</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントが有効にされました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>627</code></pre></td>
<td style="border:1px solid black;"><pre><code>パスワードの変更が試行されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>628</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウント パスワードが設定されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>629</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントが無効にされました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>630</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントが削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>631</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたグローバル グループが作成されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>632</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたグローバル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>633</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたグローバル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>634</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたグローバル グループが
削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>635</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたローカル グループが
作成されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>636</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたローカル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>637</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたローカル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>638</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたローカル グループが
削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>639</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたローカル グループが
変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>640</code></pre></td>
<td style="border:1px solid black;"><pre><code>一般アカウント データベースが変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>641</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたグローバル グループが
変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>642</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントが変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>643</code></pre></td>
<td style="border:1px solid black;"><pre><code>ドメイン ポリシーが変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>644</code></pre></td>
<td style="border:1px solid black;"><pre><code>ユーザー アカウントがロックアウトされました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>645</code></pre></td>
<td style="border:1px solid black;"><pre><code>コンピュータ アカウントが作成されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>646</code></pre></td>
<td style="border:1px solid black;"><pre><code>コンピュータ アカウントが変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>647</code></pre></td>
<td style="border:1px solid black;"><pre><code>コンピュータ アカウントが削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>648</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたローカル グループが
作成されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>649</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたローカル グループが
変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>650</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたローカル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>651</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたローカル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>652</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたローカル グループが
削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>653</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたグローバル グループが
作成されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>654</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたグローバル グループが
変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>655</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたグローバル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>656</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたグローバル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>657</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたグローバル グループが
削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>658</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたユニバーサル グループが
作成されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>659</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたユニバーサル グループが
変更されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>660</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたユニバーサル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>661</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたユニバーサル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>662</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを有効にしたユニバーサル グループが
削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>663</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたユニバーサル グループが
作成されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>664</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたユニバーサル グループが
変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>665</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたユニバーサル グループに
メンバが追加されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>666</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたユニバーサル グループの
メンバが削除されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>667</code></pre></td>
<td style="border:1px solid black;"><pre><code>セキュリティを無効にしたユニバーサル グループが
削除されました。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>668</code></pre></td>
<td style="border:1px solid black;"><pre><code>グループの種類が変更されました。</code></pre></td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><pre><code>669</code></pre></td>
<td style="border:1px solid black;"><pre><code>SID 履歴が追加されました (成功)。</code></pre></td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><pre><code>670</code></pre></td>
<td style="border:1px solid black;"><pre><code>SID 履歴が追加されました (失敗)。</code></pre></td>
</tr>
</tbody>
</table>
  
Service Pack 4 以前の Windows NT 4.0 では、イベント 642 しかログ記録されないという問題が確認されています。これは Service Pack 4 では修正されていますが、これらのほとんどのイベントは、依然として Windows 2000 のみでしか記録されません。この詳細については、次の URL の『\[NT\] セキュリティ イベントが監査中にログ出力されない』を参照してください。<http://support.microsoft.com/kb/173059>
  
ファイルおよびオブジェクトアクセスの監査を有効にすると、セキュリティアカウントマネージャ (SAM) オブジェクトへのアクセスに関するイベントが記録されることがあります。これは、SAM オブジェクトが作成されたときの既定の監査設定によるものです。この詳細については、次の URL の『NT\] セキュリティ イベントが監査中にログ出力されない』を参照してください。[http://support.microsoft.com/default.aspx?scid=kb;ja;149401](http://support.microsoft.com/kb/149401) (英語)
  
**ディレクトリ サービスのアクセスを監視する**
  
ディレクトリサービスのアクセスの監査を有効にするには、監査ポリシーの設定で、成功または失敗を示す適切なボックスを選択します。これにより、各ディレクトリサービスオブジェクトのセキュリティプロパティダイアログで、ディレクトリサービスの監査を設定できるようになります。
  
現時点では、公開されているディレクトリサービスイベントのリストはありません。このようなリストが揃い次第、この部分は更新される予定です。
  
ディレクトリサービスの監査の設定に関する詳細については、次の URL の『How to Enable Auditing of Directory Service Access』を参照してください。<http://support.microsoft.com/kb/232714> (英語)
  
**SAM の低レベル監視**
  
Windows NT および Windows 2000 では、SAM はレジストリ内に保管されています。したがって、SAM 情報を保持するレジストリキーを監査することで、SAM に加えられた変更を監視できます。
  
ただし、SAM の監視は可能ですが、SAM 全体を監査することで膨大な量のイベントが生成され、システムの能力を弱めるほどではないにしても、システムに著しい負荷がかかります。
  
レジストリの監査によって SAM を監視する必要がある場合は、注意が必要な SAM オブジェクトに対するレジストリキーだけを監査するように、対象を限定して実行することを検討してください。
  
詳細については、<http://support.microsoft.com/kb/186374> (英語) を参照してください。
  
対象を限定して SAM を監査する例については、次の URL の『\[NT\] 管理者のパスワードを変更したユーザー名を確認するには』を参照してください。<http://support.microsoft.com/kb/173939>
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### パフォーマンスの監視
  
**はじめに**
  
Windows NT のパフォーマンスの監視については、数多くのドキュメントが作成されています。このドキュメントでは、重要な部分のみをまとめています。
  
コンピュータのパフォーマンスを監視する方法を理解すると、次のようないくつかの場面で役立ちます。
  
-   容量設計 - 現在および将来的な必要性に対応するために購入すべきハードウェアの量を決定します。
  
-   ボトルネックの識別 - サーバーがサービスを提供できなくなった場合、多くの場合は、何らかのリソースが消耗してしまったことが原因です。
  
-   サービス拒否攻撃の標的の識別 - この攻撃は通常、何らかのシステムリソースの消耗を狙ったものです。これは、他のあらゆるパフォーマンスボトルネックと同様に識別できます。
  
**ベースラインの設定**
  
パフォーマンス関連の多くの問題は、問題が生じた時点で記録された、1 つのパフォーマンス監視ログを見ただけでは識別できません。これは、多数のパフォーマンス値が、実装ごとに大きく異なるためです。このため、個々のサーバーのベースラインを定期的に設定することを強くお勧めします。
  
以下に、ベースライン設定に関するいくつかのヒントを示します。
  
-   長期間 (1～2 週間) にわたり、長めの時間間隔で (15 分以上) ベースラインを設定します。これにより、一日の時間帯または曜日に基づき、使用状況のパターンを調べ、確認することができます。
  
-   ベースラインには、すべてのカウンタを含めます。将来的に、どのような値の比較が必要になるか分かりません。
  
-   ベースラインは定期的に設定し、構成を変更した場合は再設定します。使用状況パターンは、時間ごとまたは日ごとに周期的に変化しますが、長期的にも変化します。また、構成上の小さな変更であっても、パフォーマンスに大きな影響を与える場合があります。
  
**重要なカウンタ**
  
以下に、システム上の 4 つの主要なボトルネックを示します。
  
-   CPU の負荷
  
-   使用可能なメモリ
  
-   ディスクシステムのパフォーマンス
  
-   ネットワーク帯域幅
  
パフォーマンス問題に最初に注目する時点では、まず以下のカウンタを確認することで、コンピュータ状態の概要を把握することができます。
  
-   **Memory\\Available Bytes** ‐ このカウンタ値が低いままで推移している場合は (4 MB 未満)、メモリのボトルネックが生じている可能性があります。
  
-   **Memory\\Pages/sec** ‐ このカウンタ値が、特定の期間において平均 10 以上になる場合は、メモリのボトルネックが生じている可能性があります。
  
-   **Memory\\% Committed Bytes In Use** ‐ このカウンタ値が常に 100% 近くで推移している場合は、メモリのボトルネックが生じている可能性があります。
  
-   **Processor\\% Processor Time** ‐ このカウンタ値が常に 100% 近くで推移している場合は、CPU のボトルネックが生じている可能性があります。
  
-   **Physical Disk\\% Disk Time** ‐ このカウンタ値が常に 67% 以上で推移している場合は、ディスクのボトルネックが生じている可能性があります。
  
-   **Physical Disk\\Avg. Disk Queue Length** ‐ このカウンタの平均値が 2 以上になる場合は、ディスクのボトルネックが生じている可能性があります。
  
-   **Network Segment\\% Network Utilization** ‐ このカウンタ値が、使用するネットワークの種類における一般的な限界値に近い場合は、ネットワークボトルネックが生じている可能性があります (イーサネット = 35%、交換イーサネット = 85%、トークンリング = 75%)。
  
以上の分野でのボトルネックは、セキュリティ関連以外の多くの原因よって生じます。しかし、これらのカウンタは、システムの全般的な状態を判断するための最適な開始点となります。したがって、どのようなパフォーマンス監視計画にも組み込むべきだと考えられます。
  
**注目すべきその他のカウンタ**
  
セキュリティ上の理由でパフォーマンスを監視する場合は、通常、何らかの事態に対応して監視を実行することになります。たとえばサービス拒否攻撃などの状況が発生すると、これに対して、消耗したリソース、またはシステムリソースを消耗させているプロセスを特定するために監視を実行します。
  
しかし、事前に監視すると便利なカウンタもいくつか存在します。
  
-   NTDS/Kerberos Authentications および NTDS/NTLM Authentications - 月曜の朝でもないのに、認証要求の頻度が急に上昇した場合は、ネットワークに対して何者かがパスワード推測攻撃を試行している可能性があります。認証の失敗が大量に生じていないかどうか、イベントログを確認してください。
  
-   NTDS/Enumerations/sec - このカウンタ値が急に上昇した場合は、パスワード攻撃の準備として、何者かが SAM をスキャンしている可能性があります。
  
-   NTDS/KDC AS Requests - このカウンタ値が急に上昇した場合は、何者かがネットワーク侵入を試みている可能性があります。
  
-   DNS/Total Query Received/sec - このカウンタ値が急に上昇した場合は (DNS サーバーのみ)、何者かが DNS サーバーをスキャンして、攻撃の標的とするホストを探している可能性があります。
  
-   DNS/Zone Transfer Request Received - このカウンタ値が急に上昇した場合は (DNS サーバーのみ)、攻撃の準備として、何者かがネットワーク上のホストのリストを取得しようとしている可能性があります。
  
(NTDS カウンタは Windows 2000 ドメインコントローラのみで有効)
  
この他、Microsoft Internet Information Server および Microsoft Exchange Server などの他のサービス向けのカウンタもあります。これらのカウンタからも、セキュリティの脅威に関する情報を事前に取得できます。カウンタを選択する際は、想像力を駆使します。ハッカーツールをダウンロードし、実際にテストシステムに対して使用してみることで、予想されるパフォーマンスカウンタがどのように変化するかを確認できます。
  
何にも増して重要となるのが、ベースラインパフォーマンスログを作成しておくことです。値の急激な上昇は、何かを意味することもあれば、そうでないこともあります。この上昇が、毎日または毎週同じ時間帯に発生するのであれば、特に心配すべき点がないことが分かります。
  
**Windows 2000 のパフォーマンスログおよび警告**
  
Windows 2000 では、パフォーマンスモニタアプリケーションに代わり、2 つの新たな Microsoft 管理コンソール (MMC) プラグインが導入されました。リアルタイムデータまたはログデータに基づきパフォーマンスカウンタの統計を表示する System Monitor と、パフォーマンスログを生成し、特定の構成条件の発生時に警告を生成するための Performance Logs and Alerts です。
  
Performance Logs and Alerts によって生成されるログは、Windows NT 4.0 形式のログよりも内容が多様化しています。このログは周期的または連続的に生成でき、SysMon で読み取り可能なバイナリ形式、またはテキスト形式で保存できます。テキスト形式で保存すると、データベースまたはスプレッドシートへのインポートに便利です。
  
警告機能は、セキュリティの観点から特に重要です。指定のカウンタ (1 つまたは複数) が指定のしきい値を越えると、指定のアクションが実行されます。このアクションは、イベントとして発生させることも (ソース : SysMonLog、イベント ID : 2031)、パフォーマンスログの開始や指定のコマンドの実行を指定することもできます。コマンドを指定する場合は、警告機能によって、警告についての情報をコマンドに渡すことができます。
  
**詳細情報**
  
Windows NT および Windows 2000 のパフォーマンス監視およびチューニングに関する詳細については、以下を参照してください。
  
-   『Microsoft Windows 2000 リソースキット』 (Microsoft Press、2000 年)
  
-   『Microsoft Windows NT Workstation 4.0 リソース キット』 (Microsoft Press、1996 年)
  
-   『Microsoft Windows NT 3.51 リソースキット』 (Microsoft Press、1994 年)
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### その他の監視
  
**特定のコンポーネントに対する詳細なログを記録する**
  
Windows NT および Windows 2000 の多くのコンポーネントは、Event Log サービスとは別に、独自のログ機能を備えています。以下に、このようなログ機能をサポートしているコンポーネントの概要リストを示します。
  
-   インターネットインフォメーションサービス (IIS) ログ記録。IIS では非常に詳細なログファイルを生成でき、非常に柔軟な構成オプションを指定できます。詳細については、<http://msdn.microsoft.com/library/ms953324.aspx> (英語) を参照してください。
  
-   IIS ログ記録の拡張に関する詳細については、<http://msdn.microsoft.com/library/ms525410.aspx> (英語) を参照してください。
  
-   PPP (Point-to-point protocol) ログ記録。
  
    [http://support.microsoft.com/kb/115929"](http://support.microsoft.com/kb/115929) の『Windows NT で PPP ログ出力を有効にする』を参照してください。
  
-   RAS (リモートアクセスサービス) ログ記録。
  
    <http://support.microsoft.com/kb/161426> (英語) の『How to Enable Logging with Routing and Remote Access』を参照してください。
  
**チェック済みビルド**
  
新規プログラムを作成する際は、多くの場合、プログラムの各コンポーネントの動作に対する詳細ログを作成するための、特別な命令を追加すると便利です。これにより、トラブルシューティングを容易にし、開発期間を短縮できます。マイクロソフトでは、Windows NT または Windows 2000 の新規コンポーネントを開発する場合に、よくこの手法を利用します。マイクロソフトではこれを "チェック済み" コードと呼びます。
  
このようなログ記録を実行すると、パフォーマンスに著しい影響が及ぶため、ソフトウェアの最終バージョンでは、通常はこのコードを無効にしておきます。
  
しかし、マイクロソフトは、MSDN (Microsoft Developer Network) サブスクリプションの一環として、Windows のチェック済みバージョンを開発者向けに公開しています。また、Microsoft Product Support Services では、問題解決に役立てるために、しばしばチェック済みコードをお客様に配布しています。
  
問題解決を行う以外では、チェック済みコードによって実稼動システムを実行しないでください。以下に、Windows で使用でき、トラブルシューティングに一般に使用される詳細ログ機能のリストを示します。詳細情報が必要な場合、またはチェック済みコードを入手するには、Microsoft Product Support Services にお問い合わせください。
  
**チェック済み NetLogon**
  
<http://support.microsoft.com/kb/189541> の 『Netlogon.dll のチェックビルドを使用してアカウントのロックアウトを追跡する』を参照してください。
  
**チェック済み UserEnv**
  
<http://support.microsoft.com/kb/154120> (英語) の 『Debugging User Profiles and System Policies in Windows NT 4.0』を参照してください。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 監視ユーティリティ
  
**イベントログの管理**
  
マイクロソフトは、イベントログの管理および分析に役立つ多数のツールを提供しています。
  
-   *Systems Management Server (SMS) 2.0。*特定のイベントを SNMP トラッブに変換し、これを SNMP 管理コンソールまたは SMS トラップリスナ (またはその両方) に報告します。報告を受けた SNMP 管理コンソールまたは SMS トラップリスナは、この情報を中央のデータベースに記録します。
  
-   *Dumpel.exe。*Windows NT 4.0 および Windows 2000 リソースキットに付属するユーティリティ。ローカルまたはリモートイベントログ内のイベントを、コンマ区切りテキストファイルにダンプします。この形式のダンプデータは、別のアプリケーションにインポートして分析する目的に適します。
  
-   *Uptime.exe。*マイクロソフトの Web サイトから入手可能なユーティリティ。システム上のイベントログを分析し、このシステムの可用性についてのレポートを生成します。
  
-   *Elogdmp.exe。*Windows 2000 リソースキットに付属するユーティリティ。イベントログ全体を、コンマ区切りテキストファイルにダンプします。
  
-   *Cybersafe Log Analyst*。Windows 2000 リソースキットに付属するユーティリティ。Windows 2000 のセキュリティイベントログの分析を支援します。
  
-   *Seagate Software Crystal Reports*。Windows NT 4.0 および Windows 2000 リソースキットに付属するユーティリティ。Windows 2000 のイベントログ内の情報に基づくカスタムレポートを生成します。
  
**監査と監査ポリシー**
  
*Auditpol.exe*。Windows 2000 リソースキットに付属するユーティリティ。管理者はこれにより、ローカル監査ポリシーをコマンドラインから閲覧または修正できます。
  
**パフォーマンの監視**
  
-   *System Monitor*。Windows 2000 に付属する MMC プラグイン。リアルタイムでのパフォーマンス監視、またはパフォーマンスログの収集や検証を行います。
  
-   *PerfMon4.exe*。Windows NT 4.0、および Windows 2000 リソースキットに付属する、PerfMon の Windows NT 4.0 バージョン。
  
-   *Setedit.exe*。Windows 2000 リソースキットのツールである PerfMon グラフ設定エディタ。これにより、パフォーマンスカウンタの標準的なセットを簡単に検証するための、グラフ設定ファイルを作成できます。
  
-   *Perfmtr.exe*。Windows 2000 リソースキットに付属する、コマンドライン型のパフォーマンス監視ツールです。
  
-   *Exctrlst.exe*。Windows 2000 リソースキットのユーティリティ。現在インストールされている、拡張可能なパフォーマンスカウンタについての情報を表示します。
  
-   *Diskperf.exe*。Windows NT 4.0 および Windows 2000 のユーティリティ。ディスクパフォーマンスカウンタの有効/無効を切り替えます。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 参考資料と関連リンク
  
Microsoft TechNet のセキュリティ Web サイト  
<http://www.microsoft.com/japan/technet/security/>
  
『Securing Microsoft Windows NT Installation』  
<http://msdn.microsoft.com/library/ms995342.aspx>
  
『\[NT\] セキュリティ イベントについて』  
<http://support.microsoft.com/kb/174074>
  
© 2000 Microsoft Corporation.All rights reserved.
  
このドキュメントに記載されている情報は、このドキュメントの発行時点におけるマイクロソフトの見解を反映したものです。変化する市場状況に対応する必要があるため、このドキュメントは、記載された内容の実現に関するマイクロソフトの確約とはみなされないものとします。また、発行以降に発表される情報の正確性に関して、マイクロソフトはいかなる保証もいたしません。
  
このドキュメントは情報提供の目的のためのみに発行されています。明示または黙示に関わらず、これらの情報についてマイクロソフトはいかなる責任も負わないものとします。
  
Microsoft、Active Directory、JScript、Visual Basic、Windows、および Windows NT は、米国 Microsoft Corporation の米国およびその他の国における登録商標または商標です。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
##### 目次
  
-   [管理権限におけるデータ セキュリティとデータ可用性](https://technet.microsoft.com/ja-jp/library/f00d5a40-ca77-48f5-b90a-9d5d7ca74c0b(v=TechNet.10))  
-   [エンド システムにおけるデータ セキュリティとデータ可用性](https://technet.microsoft.com/ja-jp/library/ac606a24-db6f-4f89-bb4f-db663cc30513(v=TechNet.10))  
-   [ローカル通信システムの IP セキュリティ](https://technet.microsoft.com/ja-jp/library/57e1b0cf-7e2f-4ed2-9c3c-f6484f5cbfca(v=TechNet.10))  
-   エンド システムの監視と監査  
-   [名前解決の管理者権限](https://technet.microsoft.com/ja-jp/library/2111f659-da43-4bfb-b6a7-80d8056a2ba4(v=TechNet.10))
  
[](#mainsection)[ページのトップへ](#mainsection)
