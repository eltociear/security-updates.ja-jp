---
TOCTitle: 'MS01-023'
Title: 'マイクロソフト セキュリティ情報 MS01-023 - 緊急'
ms:assetid: 'ms01-023'
ms:contentKeyID: 61228371
ms:mtpsurl: 'https://technet.microsoft.com/ja-JP/library/ms01-023(v=Security.10)'
---

Security Bulletin

マイクロソフト セキュリティ情報 MS01-023 - 緊急
===============================================

ISAPI エクステンションの未チェックのバッファにより IIS 5.0 サーバーのセキュリティが侵害される
---------------------------------------------------------------------------------------------

公開日: 2001年5月2日 | 最終更新日: 2001年6月1日

#### 概要 :

**このセキュリティ情報の対象となるユーザー** **:**
Microsoft® Windows® 2000 を使用している全ての Web サーバー管理者

**脆弱性の影響** **:**
システム コンテキストで、攻撃者の選択したコードが実行される

**推奨する対応策** **:**
IIS 5.0 サーバー管理者は、この更新プログラムを直ちにインストールすることを強く推奨します。

**影響を受けるソフトウェアのバージョン** **:**

-   Microsoft Windows 2000 Professional
-   Microsoft Windows 2000 Server
-   Microsoft Windows 2000 Advanced Server
-   Microsoft Windows 2000 Datacenter Server

**注** **:**
この脆弱性は、IIS 5.0 が動作している場合にのみ発生します。

### 詳細

問題
----

<span></span>
**技術的な説明** **:**
Windows 2000 では、Internet Printing Protocol (IPP) がネイティブでサポートされています。IPP は、HTTP 経由で印刷ジョブの送信と制御を行うための業界標準プロトコルです。このプロトコルは ISAPI エクステンションを使って Windows 2000 に実装されています。ISAPIエクステンションは全ての Windows 2000 サーバーに既定でインストールされますが、IIS 5.0 を介した場合のみアクセスすることができます。
その ISAPIエクステンションの入力パラメータを処理するコードのある部分に、未チェックのバッファが含まれるためにセキュリティ上の脆弱性が発生します。この脆弱性を利用してリモートの攻撃者は、バッファ オーバーラン攻撃を仕掛け、選択したコードをサーバー上で実行することができます。このようなコードは Local System のセキュリティ コンテキストで実行されます。これにより、攻撃者はサーバーを完全に制御できるようになり、事実上、攻撃者の選択した操作の全てが実行できるようになってしまいます。
攻撃者は Web セッションを実行できるサーバー全てに対して、この脆弱性を利用することができます。その他のサービスが利用可能である必要はありませんが、ポート80 (HTTP) または 443 (HTTPS) だけは開いている必要があります。これは明らかに非常に深刻な脆弱性であり、マイクロソフトは IIS 5.0 管理者にこの更新プログラムを直ちにインストールすることを強く推奨します。
この更新プログラムをインストールすることができない場合には、インターネット印刷を無効に設定してシステムを保護することができます。理論上は、インターネット サービス マネージャのインターネット 印刷 ISAPI エクステンションのマッピングを解除することによって無効にすることができますが、その場合-グループ ポリシーがインターネット サービス マネージャの設定を上書きしてしまうことに注意してください。よく寄せられる質問で、グループ ポリシーを使ってインターネット印刷を無効にする、より望ましい方法に関して詳細に説明しています。

**問題を緩和する要素** **:**

-   インターネット印刷 ISAPIエクステンションへのマッピングが削除されているサーバーはこの脆弱性による危険性はありません。マッピングを削除する手順は、[IIS 5.0 セキュリティのチェックリスト](http://www.microsoft.com/japan/technet/archive/security/chklist/iis5cl.mspx)で説明しています。ユーザーが明示的にインターネット印刷を使い続ける選択をしない限り、チェックリスト記載のセキュリティ テンプレートと [Windows 2000 Internet Security Tool](http://www.microsoft.com/japan/technet/security/tools/) は、そのマッピングを削除します。
-   攻撃者が制御範囲を、攻撃した Web サーバーから他のマシンに広げられるか否かは、主にネットワークの構成によって異なります。ネットワークの構成では Web サーバーのようにネットワークの末端にあるマシンに存在する特殊なリスクを考慮し、DMZ を利用したり、ドメインのメンバシップを制限するなどの手段を利用して、そのようなマシンをネットワークの他の部分から分離させておくことを推奨します。これらの対策により、攻撃者が攻撃の範囲を広げるのを防ぐことができます。

**脆弱性識別番号** **:**
[CAN-2001-0241](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=can-2001-0241)

**テストしたバージョン** **:**
マイクロソフトは Windows 2000 をテストし、これらの脆弱性による影響を評価しました。この脆弱性の問題になっている点は、それより前の Windows のバージョンと、Windows NT® の全てのバージョンに関しては、存在しません。

よく寄せられる質問
------------------

<span></span>
**どのようなことが起こる可能性がありますか?**

これは[バッファ オーバーラン](http://www.microsoft.com/japan/security/glossary.mspx)の脆弱性です。通常、バッファ オーバーラン攻撃は深刻ですが、以下の 2 つの理由のため、この脆弱性にはさらに大きな危険性があります。

-   既定の状態で、インターネットでの攻撃者に利用される可能性があります。
-   この脆弱性を利用して、攻撃者は該当する Web サーバーを完全に制御することができます。これにより、攻撃者はプログラムのインストールと実行、サーバーの再設定、ファイルや Web ページの追加、変更、削除、また他の操作など、任意の操作を行うことができます。

これは非常に深刻な脆弱性ですので、マイクロソフトは全ての IIS 5.0 Web サーバーの管理者に直ちにこの更新プログラムを適用することを推奨します。IIS 4.0 サーバーはこの脆弱性による影響は受けません。

**何が原因で起こりますか?**

この脆弱性は Windows 2000 のインターネット印刷 ISAPI エクステンションに未チェックのバッファが含まれているために起こります。このエクステンションに特別に作成されたリクエストを送信することにより、攻撃者は Local System コンテキストでコードを実行することができます。

**ISAPI** **エクステンションとは何ですか?**

ISAPI （Internet Services Application Programming Interface） により、Web 開発者は Web サーバーに新しいサービスを提供するためのカスタム コードを記述し、Web サーバーの機能を拡張することができます。新しい機能が低レベル サービスを提供する場合、カスタム コードを ISAPI フィルタに実装することができます。また、高レベル サービスを提供する場合には、カスタム コードを ISAPI エクステンションに実装することができます。この場合、影響を受けるコードは ISAPI エクステンションです。

**ここで問題となっている** **ISAPI** **エクステンションとは何ですか?**

該当する ISAPI エクステンションは [RFC 2910](http://www.ietf.org/rfc/rfc2910.txt?number=2910) と [2911](http://www.ietf.org/rfc/rfc2911.txt?number=2911) で定義されている業界標準の Internet Printing Protocol （IPP） を実装しているものです。IPP は印刷サービスをリクエストするための方法を提供し、HTTP 経由で、インターネットでの印刷ジョブの状態を確認することができます。例えば、IPP を使用して、移動中のユーザーはインターネットでの印刷ジョブを送信し、そのユーザーの社内ネットワークにあるプリンタで印刷を行うことができます。また、その印刷リクエストがエラーを起こさずに完了したかどうかを確認することができます。
Windows 2000 はインターネット印刷のためのネイティブ サポートを導入しました。Windows 2000 の実装により、ユーザーは直接 URL への印刷を行い、ブラウザを介して印刷ジョブに関する情報を表示することができます。インターネット印刷のためのサポートは全ての Windows 2000 サーバー製品に既定で有効となっています。

**Windows 2000** **のインターネット印刷** **ISAPI** **エクステンションの何が問題になっていますか?**

このエクステンションには、ユーザーの印刷リクエストを処理するコードの一部に未チェックのバッファが含まれています。改ざんされた印刷リクエストがこれに送信されると、バッファ オーバーランが発生します。

**バッファ オーバーランとは何ですか?**

まず最初にバッファとは何であるかを説明します。バッファはプログラムの状態に関する情報、中間の計算結果、入力パラメータなどのデータを格納するために使用されるプログラムのメモリ領域です。バッファにデータを格納する前に、プログラムは常にバッファが全てのデータを格納するために十分な大きさであるかどうかを確認しなければなりません。これが行われない場合、データがバッファをオーバーランさせ、近隣するデータを上書きします。このため、プログラムの実行中に、そのプログラムが変更されることになります。
バッファをオーバーランさせるデータがでたらめなデータである場合、それは有効なプログラムのコードではありません。そして、そのプログラムはでたらめなデータを実行しようとして失敗します。また、データが有効なプログラムのコードである場合、そのプログラムは新しいコードを実行し、データを供給したユーザーが選択した新しい機能を実行します。

**攻撃者はどのようにしてこの脆弱性を利用するのですか?**

該当する Web サーバーへ改ざんされたインターネット印刷リクエストを送信することにより、攻撃者はバッファ オーバーラン攻撃を利用し、インターネット印刷 ISAPI エクステンションの機能を変更することができます。これにより、攻撃者はそのサーバーで任意の操作を行うことができます。

**この脆弱性はどのくらい深刻なのですか?**

これは非常に深刻な脆弱性です。マイクロソフトは全てのユーザーに直ちにこの更新プログラムを適用することを強く推奨します。攻撃者はこの脆弱性を利用して、該当する Web サーバーを完全に制御することができます。さらに深刻な点は、多くの場合、この脆弱性はインターネットから利用できてしまう、ということです。
この脆弱性を発見した eEye Digital Security 社は、マイクロソフトとともにこの問題に取り組み、該当する Web サーバーでコマンド プロンプトを開くために使用されるシナリオの説明をしました。このようなシナリオにより、インターネットでの攻撃者はサーバーで任意のコマンドを実行することができます。

**なぜこの脆弱性により攻撃者は高い権限を取得することができるのですか?**

インターネット印刷 ISAPI エクステンションは、オペレーティング システム自身である Local System のセキュリティ コンテキストで動作します。実質的に、攻撃者のコードはインターネット印刷 ISAPI エクステンションの一部であるため、同じコンテキストで実行されます。

**Web** **サーバーでの** **Local System** **権限を取得することにより、攻撃者は何ができますか?**

この問題により、攻撃者はサーバーを完全に制御することができます。攻撃者が選択した任意のプログラムをマシンにロードし、実行することができます。そして、Web ページを含む、マシンでのデータの追加、変更、削除、またシステム コマンドの実行、再設定、新規ユーザーの追加や既存のユーザーの削除、ハード ドライブの再フォーマットなど任意の操作を行うことができます。

**ファイアーウォールにより、攻撃者がこの脆弱性を利用することを防ぐことはできますか?**

ファイアーウォールにより可能または不可能な防御について十分に理解することが必要です。インターネット印刷は HTTP またはHTTPS で Web セッションの一部として動作します。このため、攻撃者が 該当するサーバーと Web セッションを開始すると、この脆弱性を利用することができます。ファイアーウォールに関して鍵となる問題は Web セッションを妨害することができるかどうかです。
ファイアーウォールが HTTP および HTTPS リクエストをブロックするように設定されている場合、インターネット ベースの攻撃者はファイアーウォールで保護されているサーバーで、この脆弱性を利用することはできません。なぜなら、攻撃者は Web セッションを開始することができないからです。一方、ファイアーウォールが Web セッションを許可している場合、そのファイアーウォールがその他の全てのポートとサービスブロックしている場合でも、ファイアーウォールにより保護されているサーバーはこの脆弱性の影響を受ける可能性があります。

**この脆弱性を利用して、攻撃者はドメイン全体を侵害することができますか?**

最善のセキュリティ対策が講じられている場合、侵害の可能性は制限されます。Web サーバー （特にパブリック サーバー） は外部と接触する位置にあるため、特に攻撃の対象となります。このため、ネットワークの設計はこの事実を考慮する必要があります。ネットワーク構成の主要な目的の 1 つはネットワークの設計により、侵害された Web サーバーを使用して可能になる操作を制限することです。特に、次の 2 つの対応策を講じる必要があります。

-   Web サーバーは DMZ 内で隔離されている必要があります。つまり、サーバーをインターネットから隔離するだけでなく、その他のネットワークからも隔離する必要があります。
-   可能であれば、Web サーバーをスタンドアロン マシンとして設定するべきです。Web サーバーをドメインの一部としなければならない場合、ドメインは DMZ に存在するマシンのみを含むようにします。Web サーバーはさらに規模の大きいネットワークのドメインのメンバーであってはいけません。

これらの事前の対応策が講じられていたとしても、この脆弱性による損害を過小評価しないことが重要です。攻撃者に通常のシステム操作を使用して制御を拡張するための容易な手段を与えないようにネットワークが設計されているとしても、攻撃者は既知の脆弱性を利用し、他のマシンに攻撃を開始する出発点として、侵害されたサーバーを利用する可能性があります。

**バッファ オーバーラン攻撃は、影響を受けたソフトウエアを異常終了させるために使われるとのことですが、この問題でも同じですか?**

攻撃者が ISAPI エクステンションの一部としてコードを実行させる印刷リクエストを送信せず、代わりにランダム データでバッファをオーバーランさせるリクエストを送信する可能性があります。しかし、IIS 5.0 サービスは異常終了した後に自動的に再び開始するため、[サービス拒否](http://www.microsoft.com/japan/security/glossary.mspx)攻撃を有効に行うためにバッファ オーバーラン攻撃を利用することはできません。

**インターネット印刷** **ISAPI** **エクステンションは** **Window 2000** **か** **IIS 5.0** **の一部なのですか?**

インターネット印刷 ISAPI エクステンションは Windows 2000 のコンポーネントの一つで、全ての Windows 2000 に既定でインストールされます。しかし、インターネット印刷 ISAPI エクステンションへのリクエストは、HTTP または HTTPS を経由してのみ送信することができるため、IIS 5.0 が使用可能になっている場合にのみこの脆弱性が利用される可能性があります。

**サーバーを展開する際に** **IIS 5.0** **セキュリティのチェックリストを使用し、それに従って必要のない** **ISAPI** **マッピングを全て削除しました。この脆弱性の影響を受けますか?**

インターネット印刷 isapi エクステンションのマッピングが削除されている場合、インターネット印刷のリクエストは送信されず、よってこの脆弱性を利用される可能性はありません。 [チェックリスト](http://www.microsoft.com/japan/technet/archive/security/chklist/iis5cl.mspx) に従ってインターネット印刷 isapi エクステンションのマッピングを削除してあれば、この脆弱性による影響はありません。

**IIS 5.0** **セキュリティのチェックリストの中のセキュリティ テンプレートを使用しました。この脆弱性による影響を受けますか?**

[チェックリスト](http://www.microsoft.com/japan/technet/archive/security/chklist/iis5cl.mspx)の中で提供されているセキュリティ テンプレート (hisecweb.inf) は、インターネット印刷 isapi エクステンションを削除するため、そのテンプレートを使用した場合この脆弱性による影響はありません。

**Web** **サーバーを構築する際に** **Windows 2000** **インターネット サーバー セキュリティ ツールを使用しました。この脆弱性からシステムを保護するのに役立ちますか?**

はい。このツールには Web サーバーを使用して提供する必要のあるサービスに関する質問が含まれています。インターネット印刷を使用する設定を特にしない限り、この[ツール](http://technet.microsoft.com/ja-jp/security/cc297183.aspx) によってインターネット印刷 ISAPI エクステンションのマッピングが無効になります。

**この脆弱性は** **IIS 4.0** **サーバーに影響を及ぼしますか?**

いいえ。インターネット印刷のサポートは、Windows 2000 で導入されていますが、Windows NT 4.0 にはありません。従って IIS 4.0 サーバーにはこの脆弱性による影響はありません。

**更新プログラムは何を変更しますか?**

この更新プログラムは ISAPI エクステンションの入力をチェックすることで、この脆弱性を排除します。

**更新プログラムをインストールしたくありません。他に** **Web** **サーバーを保護するのに方法がありますか?**

web サーバーを保護するのに最も良い方法はこの更新プログラムをインストールすることです。しかし、何らかの理由でインストールできない場合、インターネット印刷を無効にすることでもサーバーを保護することができます。この方法は以下の通りです。（[internet information services 5 セキュリティのチェックリスト](http://www.microsoft.com/japan/technet/archive/security/chklist/iis5cl.mspx)でも説明しています。）

1.  microsoft 管理コンソールを起動し、グループ ポリシーのスナップインを追加します。
2.  \[コンピュータの構成\] を選択し、\[管理用テンプレート\] 、次に \[プリンタ\] を選択します。
3.  \[web ベース印刷\] の設定で、無効になっていることを確認します。

注: サーバーがドメインの一部である場合、web ベースの印刷がドメイン グループ ポリシーでも無効になっていることを確認してください。

**以前の情報で、インターネット サービス マネージャを使用してインターネット印刷** **ISAPI** **エクステンションのマッピングを解除し、無効にすることが推奨されていましたが、推奨される対応策が変更したのはなぜですか?**

以下の 2 つの理由から、推奨する対応策を変更しました。

-   グループ ポリシーがインターネット サービス マネージャの設定を上書きするため、グループ ポリシーでインターネット印刷を無効にした方が、より確実に解決できます。
-   インターネット印刷をインターネット サービス マネージャを使用して無効にすると、Outlook Web Access の稼働に干渉する可能性があります。具体的には、Exchange 2000 サーバーのインターネット サービス マネージャを使用してインターネット印刷 ISAPI エクステンションのマッピングを解除する場合、Exchange、Public、ExAdmin を含む子フォルダへ変更を適用するかどうかを確認する画面が表示されます。子フォルダへその設定を適用する選択をした場合、Outlook Web Access の機能が、Exchange System Attendant を再開するまで停止してしまいます。

**インターネット印刷がシステムで有効になっているか分かりません。印刷リクエストをサーバーに送信し、その結果を利用して有効になっているか確認できますか?**

いいえ、できません。サーバーから受け取る応答は、多くの要素によって変わってきます。従って、サーバーに印刷リクエストを送信するのは、インターネット印刷が有効になっているかを確認する確実な方法とは言えません。インターネット印刷が有効か否かを確実に確認する唯一の方法は、サーバーにログオンし、グループ ポリシー設定を確認することです。（詳細は前の Q&A で確認してください。）

更新プログラム
--------------

<span></span>
この問題に対する修正は Windows 2000 Service Pack 2 以降に含まれております。最新の Windows 2000 Service Pack については次のリンクから入手してください。
<http://www.microsoft.com/japan/windows2000/downloads/>
サービスパックをご利用にならない場合、この問題に対する修正の含まれた [MS01-026](http://technet.microsoft.com/security/bulletin/ms01-026) をご利用下さい (NEC PC98 シリーズを除く)。MS01-026 には、それまでの IIS 関連の修正がすべて含まれておりますので、MS01-026 のご利用をお勧めします。
個別の日本語版更新プログラムは、以下のサイトからダウンロードできます。

-   Microsoft Windows 2000 Server および Advanced Server: 
    -   PC/AT 互換機用
        [/downloads/details.aspx?FamilyId=3639622e-e18e-40ad-a0ce-6d4cdc93c06e&displaylang=ja](http://www.microsoft.com/downloads/details.aspx?familyid=3639622e-e18e-40ad-a0ce-6d4cdc93c06e&displaylang=ja)
    -   NEC PC-9800 シリーズ用
        [http://download.microsoft.com/download/win2000platform/patchNEC/q296576/NT5/JA/Q296576\_w2k\_sp2\_NEC98\_JA.EXE](http://download.microsoft.com/download/win2000platform/patchnec/q296576/nt5/ja/q296576_w2k_sp2_nec98_ja.exe)
-   Microsoft Windows 2000 Datacenter Server:
    Windows 2000 Datacenter Server の更新プログラムの適用に関してはそれぞれのデータセンター サーバーを購入されたハードウェア ベンダー様へご相談下さい。

#### 更新プログラムに関する追加情報

**対象プラットフォーム** **:**
この更新プログラムは、Windows 2000 および [Service Pack 1](http://www.microsoft.com/japan/windows2000/downloads/recommended/sp1/)を動作しているシステムにインストールすることができます。

**今後リリースされるサービス パックに含まれる更新プログラム** **:**
この問題に対する更新プログラムは、Windows 2000 Service Pack 2 に含まれています。

**移行する更新プログラム** **:**
なし

**更新プログラムのインストール確認方法** **:**

-   この更新プログラムがマシンにインストールされたことを確認するためには、マシンに次のレジストリ キーが作成されたことを確認して下さい。HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Windows 2000\\SP1\\Q296576
-   各ファイルを確認するためには、次のレジストリ キーで、日付、時間そしてバージョン情報を参照して下さい。HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Updates\\Windows 2000\\SP1\\Q296576\\Filelist

**警告** **:**
なし

**他のセキュリティ更新プログラムの入手先** **:**
他のセキュリティ問題を解決する更新プログラムは以下のサイトから入手できます。

-   セキュリティ更新プログラムはマイクロソフト [ダウンロード センター](http://www.microsoft.com/downloads/results.aspx?displaylang=ja&freetext=security_patch)からダウンロードすることができます。「security\_patch」のキーワード検索によって容易に見つけることができます。
-   コンシューマ プラットフォーム用の更新プログラムは、[Microsoft Update](http://update.microsoft.com/microsoftupdate/)Web サイトからダウンロードできます。

更新プログラムについてのご質問は、マイクロソフト プロダクト サポート までご連絡ください。マイクロソフトでは、ご質問の内容が弊社製品の不具合が原因の場合、サポート料金はいただきません。それ以外の場合には、サポート料金を請求させていただきますのでご注意ください。
[マイクロソフト プロダクト サポートへの連絡方法はこちらをご覧ください。](http://www.microsoft.com/japan/security/support/patchqa.mspx)

### その他の情報

**詳細情報** **:**

-   US マイクロソフトセキュリティ情報（MS01-023）
    [http://www.microsoft.com/technet/security/bulletin/ms01-023.mspx](http://technet.microsoft.com/security/bulletin/ms01-023)
-   サポート技術情報 （KB） 文書番号 ： 296576
    [ISAPI エクステンションの未チェックのバッファによる IIS 5.0 のセキュリティ侵害](http://support.microsoft.com/kb/296576)

**更新履歴** **:**

-   2001/5/2: このセキュリティ情報ページを公開しました。
-   2001/5/8: セキュリティ情報を更新し、Windows 2000 Professional も影響を受けること、またインターネット印刷のグループ ポリシーの設定をした場合、インターネット サービス マネージャによる設定を上書きしてしまうことをお知らせしました。
-   2001/5/23: この問題に対する日本語版 KB を公開しました。
-   2001/6/1: よく寄せられる質問を更新し、インターネット サービス マネージャの変更を Exchange 2000 マシン上の子フォルダに適用すると、Outlook Web Access を無効にしてしまう可能性があることをお知らせしました。また、セキュリティ情報とよく寄せられる質問を更新し、インターネット印刷を無効にするためにはインターネット サービス マネージャではなくグループ ポリシーを使用することを推奨しました。

本セキュリティ情報に含まれている情報は、いかなる保証もない現状ベースで提供されるものです。Microsoft Corporation 及びその関連会社は、市場性および特定の目的への適合性を含めて、明示的にも黙示的にも、一切の保証をいたしません。さらに、Microsoft Corporation 及びその関連会社は、本文書に含まれている情報の使用及び使用結果につき、正確性、真実性等、いかなる表明・保証も行ないません。Microsoft Corporation、その関連会社及びこれらの権限ある代理人による口頭または書面による一切の情報提供またはアドバイスは、保証を意味するものではなく、かつ上記免責条項の範囲を狭めるものではありません。Microsoft Corporation、その関連会社 及びこれらの者の供給者は、直接的、間接的、偶発的、結果的損害、逸失利益、懲罰的損害、または特別損害を含む全ての損害に対して、状況のいかんを問わず一切責任を負いません。（Microsoft Corporation、その関連会社 またはこれらの者の供給者がかかる損害の発生可能性を了知している場合を含みます。) 結果的損害または偶発的損害に対する責任の免除または制限を認めていない地域においては、上記制限が適用されない場合があります。

*Built at 2014-04-18T01:50:00Z-07:00*
