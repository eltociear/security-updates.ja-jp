---
TOCTitle: 'Active Directory サイトとサービスの概要 ‐ Active Directory のサイト コンテナ階層'
Title: 'Active Directory サイトとサービスの概要 ‐ Active Directory のサイト コンテナ階層'
ms:assetid: '7d61a840-576a-41e6-9710-86c61ae8c33a'
ms:contentKeyID: 19871944
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Dd363001(v=TechNet.10)'
---

Active Directory サイトとサービスの概要
=======================================

### Active Directory のサイト コンテナ階層

最終更新日: 2003年1月17日

##### 目次

[](#ekaa)[情報の複製](#ekaa)  
[](#ejaa)[複製の目標と方針](#ejaa)  
[](#eiaa)[複製のオプション](#eiaa)  
[](#ehaa)[サイト間の複製の計画](#ehaa)  
[](#egaa)[サイト リンクの管理](#egaa)  
[](#efaa)[サイト リンク ブリッジ](#efaa)  
[](#eeaa)[複製間隔](#eeaa)  
[](#edaa)[変更通知](#edaa)  
[](#ecaa)[緊急複製](#ecaa)
[](#ebaa)[2 台のサーバー間の強制的な複製](#ebaa)  
[](#eaaa)[Active Directory コネクタの既定の複製時間の変更](#eaaa)  

Active Directory サイトとサービスは、オブジェクト階層の表示と管理に使用する管理ツールです。オブジェクトは、KCC によって複製トポロジを有効にする際に使用されます。この階層は、**Configuration** コンテナの子である **Sites** コンテナの内容として表示されます。**Sites** コンテナの識別名は、cn=Sites,cn=Configuration,dc=&lt;*ForestRootDomain*&gt; です。**Configuration** コンテナは、構成ディレクトリ パーティションの最上位オブジェクトで、**Sites** コンテナは、Active Directory 複製の管理と実行に使用するオブジェクト階層の最上位に位置します。**Sites** コンテナ階層は、次のオブジェクトで構成されています。

-   フォレスト内の各サイトのオブジェクトを含む Sites コンテナ。Sites には、サイト オブジェクト以外に Subnets コンテナも含まれおり、このコンテナに、サブネット オブジェクト形式のサブネット定義が含まれています。各サブネット オブジェクトは、サイト オブジェクトへのリンクに使用する *siteObject* 属性を持ちます。

-   それぞれ 2 つの子オブジェクトを含むサイト オブジェクト。

    -   NTDS Site Settings オブジェクト。サイト内の複製スケジュールなど、サイト内のすべてのドメイン コントローラに共通したディレクトリ プロパティを格納します。

    -   Servers コンテナ。サイト内の各ドメイン コントローラのサーバー オブジェクトを格納します。

-   NTDS Settings オブジェクトを含むサーバー オブジェクト。

-   そのサーバー上にインスタンス化された Active Directory を示す NTDS Settings オブジェクト (Active Directory をサーバーから削除すると、NTDS Settings オブジェクトが Active Directory から削除されますが、サーバー オブジェクトはそのままです)。特定のサーバー オブジェクトの場合、NTDS Settings オブジェクトに、入力方向の接続を示す個々の接続オブジェクトが含まれます。この接続は、現時点で、このドメイン コントローラへの変更を送信できる、フォレスト内の他のドメイン コントローラから出力されます。

-   指定された 2 つのドメイン コントローラ間の一方向の複製合意を示す、接続オブジェクト。この場合、宛先のドメイン コントローラは、接続を格納した NTDS Settings オブジェクトの親オブジェクトであるサーバー オブジェクトです。接続オブジェクトは、KCC によって自動的に作成されます。また手動による作成も可能です。

以下の図は、Sites コンテナを展開したところです。1 台のサーバーに対する NTDS Settings オブジェクトが選択されており、それに関連する接続オブジェクトが詳細ウィンドウに表示されています。**\[複製元サーバー\]** コラムに、選択したドメイン コントローラに複製を送信するドメイン コントローラ名 (現在の複製パートナー名) が表示されています。

![](images/Dd363001.w2kab198s(ja-jp,TechNet.10).gif)

[拡大表示する](https://technet.microsoft.com/ja-jp/dd363001.w2kab198(ja-jp,technet.10).gif)
Active Directory サイトとサービスは、Windows 2000 ドメインにアクセスできるコンピュータからのみ利用でき、すべての Windows 2000 ドメイン コントローラにインストールされています。Windows 2000 Professional を実行しているコンピュータのように、ドメイン コントローラでないコンピュータ上で、Active Directory サイトとサービスを使用するには、Windows 2000 管理ツールをインストールします。

### 情報の複製  


複製は、ディレクトリに関して情報の可用性、フォールト トレランス、負荷分散、およびパフォーマンスの面で利点をもたらします。Active Directory では、マルチマスタ複製を使って、単一のプライマリ ドメイン コントローラではなく、任意のドメイン コントローラでディレクトリを更新できるようにします。ドメイン コントローラのいずれかが動作を停止しても、複数のドメイン コントローラで複製を継続できるので、マルチマスタ モデルには高いフォールト トレランスという利点があります。

ユーザーには認識されないこともありますが、マルチマスタ複製によりディレクトリの単一のコピーを更新しています。ドメイン コントローラのいずれかでディレクトリ情報を作成または変更すると、新しいまたは変更された情報がドメイン内のすべてのドメイン コントローラに送信されます。したがって、各ドメイン コントローラのディレクトリ情報は常に最新です。

ドメイン コントローラは最新のディレクトリ情報を必要としますが、効率性を考えると、新しいまたは変更されたディレクトリ情報がある場合に限り、ドメイン コントローラを更新する必要があります。ドメイン コントローラ間でディレクトリ情報を無制限に交換すると、どんなネットワークでもすぐに処理能力を超えてしまいます。そのため Active Directory は、変更されたディレクトリ情報だけを複製するように設計されています。

マルチマスタ複製では、複数のドメイン コントローラでまったく同じディレクトリの変更が発生する可能性が常にあります。このため、Active Directory は、ディレクトリについて競合する変更を追跡、調整し、ほとんどすべての状況で競合を自動的に解決するように設計されています。

1 つのドメインに複数のドメイン コントローラを配置することによって、フォールト トレランスと負荷分散が実現されます。ドメイン内のドメイン コントローラのいずれかに処理速度の低下、稼動停止、または障害が発生した場合でも、同じドメイン内の他のドメイン コントローラに同じディレクトリ データが含まれているため、これらのコントローラが必要なディレクトリ アクセスを提供します。

[](#mainsection)[ページのトップへ](#mainsection)

### 複製の目標と方針

ユーザーおよびサービスは、フォレスト内のどのコンピュータからでも随時ディレクトリ情報にアクセスできる必要があります。これを可能にするには、ディレクトリ データの追加、変更、および削除を他のドメイン コントローラに転送しなければなりません。

たとえば、ある企業のシアトル支社でアカウントのパスワードを変更した場合、その新しいパスワードが、シドニー支社で同じアカウントでログオンする場合にも有効である必要があります。そのディレクトリの変更を、シドニー支社のドメイン コントローラを含む、他のドメイン コントローラに複製することでこれが可能になります。

ディレクトリ情報は広範囲に配布されなければなりませんが、ネットワーク パフォーマンスを最適化する必要性とバランスを調整する必要があります。ディレクトリ更新がドメイン内の他のすべてのドメイン コントローラに頻繁に配布されると、ネットワーク リソースが消費されます。接続の追加または構成、あるいは特定の接続を経由した複製は手動でも行えますが、通常は、Active Directory サイトとサービスに提供した配置情報に基づき、Active Directory 知識整合性チェッカーによって自動的に複製を最適化する必要があります。

Windows 2000 では、複製の最適化に、サイトと複製変更の制御が使用されます。

-   Active Directory で最も効率的なネットワーク接続を利用できるよう、使用している接続を随時再評価します。

-   Active Directory は、複数のルートを使って変更内容を複製し、フォールト トレランスを提供します。

-   変更された情報だけを複製することで、複製コストが最小限に抑えられます。

**サイト間の複製**

ネットワーク接続はサイト リンクによって表されます。サイト リンクを作成し、その複製の可用性、コスト、および複製頻度を設定することによって、ディレクトリ データの複製用に作成される接続オブジェクトに関する情報が Active Directory ディレクトリの知識整合性チェッカーに提供されます。Active Directory は接続オブジェクトの作成先を示すインジケータとしてサイト リンクを使用し、接続オブジェクトは、実際のネットワーク接続を使ってディレクトリ情報を交換します。サイト リンクがない場合、サイトへの接続にネットワーク接続を使用する接続オブジェクトが作成されず、ドメイン コントローラはサイト内で孤立します。この場合、ドメイン コントローラは、サイトの外部の他のドメイン コントローラとの間でディレクトリ更新を送受信できなくなります。これを回避するには、複数のサイトに接続するためのサイト リンクを作成します。

サイトを作成するときに、サイト間の特定の接続を有効にし、サイト間を接続する既存サイト リンクをカスタマイズするため、リンク数を増やす場合があります。サイト リンクを重ねて、1 つに連結してサイト リンク ブリッジにしたり、すべてのサイト リンクをブリッジして、利用可能なサイト リンクの接続性を最大にすることができます。このようにサイト リンクを構成すると、ディレクトリ情報の複製が最大限に高められます。

サイト リンク ブリッジの作成またはすべてのサイト リンクのブリッジによって複製が最大限に高められます。ただし、単一のサイト リンク内またはファイアウォールにわたってブリッジされたサイト リンク内にドメイン コントローラがある場合、エラーが発生します。サイト リンクまたはサイト リンク ブリッジ内のすべてのドメイン コントローラは、それらのサイトまたはサイト リンクにある他のドメイン コントローラに、ディレクトリ更新を送信しようとするため、ファイアウォールの外側にあるドメイン コントローラに更新を送信する場合があります。このエラーが発生すると、送信側もファイアウォールのプロキシ サーバーでない限り、ディレクトリ更新の送信は失敗します。したがって、ファイアウォールの外側にドメイン コントローラがあり、そのファイアウォールが特定のコンピュータ間でのパケット送信のみを許可するように構成されている場合、ドメイン コントローラが適切に接続されていても、1 つのサイトにすべてのドメイン コントローラを配置しないようにします。ファイアウォールの内側にあるドメイン コントローラはすべて 1 つのサイト リンクに追加し、そのサイト リンクの優先ブリッジヘッド サーバーとしてファイアウォール プロキシを構築します。このようにすると、ファイアウォールは複製を遮断しません。サイト リンクは自動的に生成されません。

最初のドメイン コントローラをインストールすると、次の 3 つの条件のいずれかに該当しない限り、他のすべてのドメイン コントローラは元のドメイン コントローラと同じサイトへ自動的に追加されます。

-   Active Directory サイトとサービスを使って代替の既定サイトを提供している。

-   ドメイン コントローラをインストールすると、代替サイトで以前に指定したサブネットでその IP アドレスが指定される。その後そのドメイン コントローラがこの代替サイトに追加される。

-   既に、新しいドメイン コントローラを追加する予定のサイトに、別のサイトからドメイン コントローラを移動した。この場合、新しいドメイン コントローラは、以前に移動したドメイン コントローラが含まれるサイトに追加される。

    **注意** : 通常ドメイン コントローラは、既存のドメイン コントローラがあるサイトにインストールできます。ただし、最初にインストールするドメイン コントローラには、この規則は当てはまりません。この場合、自動的に Default-First-Site サイトが作成されます。Default-First-Site 以外のサイトには、最初のドメイン コントローラを作成することはできませんが、あらかじめ既存のドメイン コントローラがあるサイトにドメイン コントローラを作成し、作成したドメイン コントローラを別のサイトに移動することはできます。つまり、最初のドメイン コントローラをインストールして、Default-First-Site が作成された後で、このサイトに別のドメイン コントローラを作成して、それを代替サイトに移動できます。

Active Directory はサイト内で自動的に接続 (接続オブジェクト) を作成します。ただし、サイト間では、サイト リンク内にサイトがあり、そのサイトにドメイン コントローラが含まれているときのみ、接続が自動的に生成されます。複製には、接続オブジェクトが必要です。

**注意** : 知識整合性チェッカーによって自動的に作成された、接続オブジェクトに関する情報 (説明など) は変更できますが、次回この接続オブジェクトが自動的に作成されると、このオブジェクトに対して行われた変更内容はすべて失われます。

ネットワーク接続を利用できる場合は、Active Directory サイトとサービスを使用して、そのネットワーク接続に対応するサイト リンクを追加してください。

[](#mainsection)[ページのトップへ](#mainsection)

### 複製のオプション

複製の特性は、大まかに言って、サポートされるプロトコルとサイト リンクの構成によって決まります。

**複製プロトコル**

ディレクトリ情報は、IP や SMTP などの異なるネットワーク プロトコルを使って交換できます。

**注意** : SMTP は評価された構成の対象外です。

-   **SMTP 複製**。 SMTP 複製は、サイト リンクを介した (サイト間) 複製でのみ使用され、サイト内部 (サイト内) での複製には使用されません。SMTP は非同期なので、通常、すべてのスケジュールを無視します。したがって、次の項目に該当しない場合、SMTP サイト リンク上でサイト リンク複製の可用性を構成しないでください。

    -   スケジュールされた接続をサイト リンクが使用する。

    -   SMTP キューがスケジュールされていない。

    -   ネットワーク イーサネット バックボーンのように情報を間接的に交換する場合とは違って、あるサーバーから別のサーバーに情報を直接交換している。

    ネットワークの SMTP 接続がこれらの条件を満たす場合、SMTP サイト リンク複製スケジュールと、ネットワークの SMTP 接続の利用可能回数との同期をとります。

    サイト リンクで SMTP を使用する場合、エンタープライズの証明機関をインストールし構成します。証明機関 (CA) は、ドメイン コントローラ間で交換する SMTP メッセージに署名し、ディレクトリ更新の信頼性を保証します。SMTP 複製では、56 ビットの暗号を使います。

-   **IP 複製**。IP 複製は、サイト リンクを介した (サイト間) またはサイト内部 (サイト内) での複製で、リモート プロシージャ呼び出し (RPC) を使用します。Active Directory でスケジュールを無視するように複製を構成することはできますが、既定ではサイト間の IP 複製は複製スケジュールに従います。IP 複製には CA は必要ありません。

**サイト リンク属性**

利用可能なサイト間接続に関する情報を Active Directory に提供するプロセスの一部として、すべてのサイト リンクの可用性、コスト、および頻度に関する情報を提供する必要があります。

-   **複製の可用性**。サイト リンク複製の可用性を構成し、サイト リンクでいつ複製を利用できるかを指定します。

-   **コスト**。サイト リンクのコストを構成し、サイト間の複製で利用できる各接続のコスト値を割り当てます。

    冗長的なネットワーク接続が複数ある場合、各接続に対してサイト リンクを確立し、それぞれの相対帯域幅を反映したコストをサイト リンクに割り当てます。たとえば、高速 T-1 回線があり、それが利用できないときにダイヤルアップ ネットワーク接続を使用する場合、T-1 回線には低コストを、ダイヤルアップ ネットワーク接続には高コストを構成します。Active Directory は常にコストを基準にして接続を選択します。そのため、利用可能である限り、最も低コストな接続が使用されます。コストは分単位などの特定の単位には対応しませんが、他のコストと比較した上で評価されます。サイト リンクのコストは、他のサイト リンクと関係する場合にのみ意味があります。

    クライアントは常にそのサイトのドメイン コントローラを使用する必要があります。サイトにドメイン コントローラが含まれていない場合、そのドメインのサイト リンク コストはすべての複製プロセスにより評価されます。最も近いサイトのドメイン コントローラを使って、そのドメインを含むサイトにサービスを提供します。

    サイト リンク ブリッジのコストは、ブリッジに含まれるすべてのリンクのコストの合計です。たとえば、サイト リンク ブリッジに 2 つのサイト リンクが含まれ、一方のコストが 3、もう一方のコストが 4 の場合、サイト リンク ブリッジのコストは 7 になります。

-   **複製頻度**。整数値を指定して、サイト リンクの複製間隔を構成します。これにより、接続を使って複製の更新を確認するまでの分単位の待機時間が Active Directory に通知されます。複製間隔は、少なくとも 15 分以上 10,080 分 (1 週間) 以下でなければなりません。サイト リンクが複製の発生時に利用できる必要があるので、複製の更新間隔 (分数) が経過したときにサイト リンクを利用できないようにスケジュールされている場合、複製は発生しません。

**仮想プライベート ネットワークを介した複製**

更新されたディレクトリ情報を確実に交換できるようにするには、ドメイン コントローラとの接続が常に利用できる必要があります。(小規模な支社オフィスなどでは) このような接続を利用できないことがあります。その場合は、インターネット サービス プロバイダ (ISP) を利用して確立された仮想プライベート ネットワーク (VPN) を介して、ディレクトリの更新を交換できます。このような VPN を使って別のサイトに接続する場合、すべての複製は 2 つのサイトのドメイン コントローラ間で直ちに発生するので、接続が不要になった時点で閉じることができます。これを相互複製と呼びます。

支社オフィス サイトのドメイン コントローラと本社オフィス サイトのドメイン コントローラ間で相互複製を行う場合、ISP によって VPN が確立されると、接続を開始した支社サイトのドメイン コントローラは、本社サイトのドメイン コントローラに対してすべてのディレクトリの更新を要求します。支社サイトのドメイン コントローラがすべての更新を受け取ると、本社サイトのドメイン コントローラに変更通知を送信し、本社サイトのドメイン コントローラはすべての更新を要求します。支社サイトのドメイン コントローラは、この要求に応じてすべての更新を送信します。すべてのディレクトリ情報が最新の状態になると、ISP 接続を閉じます。接続が利用できない場合、複製は発生しません。このように、ディレクトリ情報交換の効率性を最大限に高めることができると共に、接続時間を最小限に抑えます。さらに、接続を利用できないときに、本社サイトのドメイン コントローラが支社サイトのドメイン コントローラへ変更の要求を試みた場合に生じるタイムアウト エラーを回避することができます。

[](#mainsection)[ページのトップへ](#mainsection)

### サイト間の複製の計画

サイト内の複製は完全に自動化されているため、計画はほとんど必要ないか、もしくは皆無です。ただし、サイトが複数の場合、次の手順を使用して、サイト間複製の発生計画を立てることができます。

1.  バックボーンを介して適切に接続されたサイトを指定し、このサイト間に低コストなサイト リンクを作成します。

2.  同等のトランスポートですべて相互接続されたサイトをすべて指定し、中間のコストのサイト リンクを作成します。たとえば、フルメッシュのリンク (テレコム リンクを介して接続されるリモート サイト)、フレーム リレー クラウドのリンク (プライベートな仮想回線を使用するポイントツーポイント システム)、T-1 接続を使ったミディアム エリア ネットワーク (MAN) のリンクなどです。

3.  それ以外の WAN リンクを指定します。

4.  WAN リンクをまたぐ、対のサイトごとにサイト リンクを作成します。

5.  ユーザー ニーズに合わせたスケジュールを作成します。

    高い頻度を設定しないようにします。一般的にサイト リンクには、ルーティングに利用できる時間枠が必要です。

[](#mainsection)[ページのトップへ](#mainsection)

### サイト リンクの管理

サイト内の複製またはサイト間の複製いずれの場合も、KCC によって自動的に接続オブジェクトが作成されます。接続オブジェクトは 2 つのサイト間で作成されますが、2 つのサイトを接続するリンクは手動で作成する必要があります。Active Directory のサイト リンク オブジェクトを介して実装されるこのリンクは、2 つのサイト間の複製に必要なトランスポート プロトコルとスケジュールを指定します。Active Directory サイトとサービスを使用してサイト リンクを作成すると、サイト間トポロジの生成時に、KCC によってそれに応じた接続が作成されます。

Active Directory サイトとサービスの Inter-Site Transports コンテナ内の 2 つのトランスポート専用コンテナに、サイト リンク オブジェクトを作成することができます。一方のコンテナにリンクを作成すると、それぞれの複製トランスポートとリンクが関連付けられます。Inter-Site Transports コンテナは、Sites コンテナの子であると共に、自らも次の子コンテナを所有します。

-   RPC over IP 同期複製トランスポートを使用するサイト リンク オブジェクトが含まれた IP コンテナ。

-   SMTP over IP 非同期複製トランスポートを使用するサイト リンク オブジェクトが含まれた SMTP コンテナ。

KCC でサイト間複製用の接続オブジェクトを構成するときは、最適な接続を作成することを考慮に入れて、サイト リンク オブジェクトを設定します。たとえば、サイト リンク設定のひとつとして、接続のコストがあります。これを選択すると、接続の確立時に、最も低コストなリンクを持つリモート サイトが KCC によって選択されます。

IP トランスポートの場合、一般的にサイト リンクは 2 つのサイトしか接続できず、実際には WAN リンクに相当します。2 つ以上のサイトを接続する IP サイト リンクは、ATM バックボーンに相当する場合があります。これは、大規模構内の建物にある 2 つ以上のクラスタ、あるいは専用回線および IP ルーターによって接続された大規模な都市圏に属する複数のオフィスなどを接続します。

任意の数のサイト リンク オブジェクトを使って、サイトを別のサイトに接続することができます。マルチサイト ディレクトリの各サイトは、少なくとも 1 つのサイト リンクによって接続されている必要があります。接続されていない場合、他のサイト内のドメイン コントローラに一切複製できないため、ディレクトリが切断されます。したがって、フォレスト内に複数のサイトがある場合、少なくとも 1 つのサイト リンクを構成しなければなりません。

下図は、1 つのサイト リンクによって接続された 2 つのサイトを示しています。単一のドメインに両方のサイトのドメイン コントローラが属します。トポロジが生成されると、サイト内のブリッジヘッド サーバー間の接続オブジェクトが KCC によって作成され、サイト リンクの設定に応じて複製が発生します。

![](images/Dd363001.w2kab199(ja-jp,TechNet.10).gif)

下図では、3 つのサイトが 2 つのサイト リンクによって接続されています。既定ではサイト リンクは推移的です。したがって、複製メッセージはアトランタのサイトから、シアトルのサイトを経由して、ミラノのサイトへ送信されます。このシナリオでは、シアトルのサイトに reskit.com の完全な複製が含まれており、ミラノとアトランタ間で直接複製を実行する必要はありません。両者間のすべての複製は、シアトルのサイト経由で推移的に行われます。

![](images/Dd363001.w2kab200(ja-jp,TechNet.10).gif)

**サイト リンクの設定**

\[Active Directory サイトとサービス\] の **\[サイト リンクのプロパティ\]** ダイアログ ボックスの **\[全般\]** タブには、サイト リンクを構成して、複製トポロジを制御するためのオプションが含まれています。

-   接続する 2 つ以上のサイトの一覧。

-   スケジュール。リンクを利用して複製できる期間を指定します。たとえば、ダイヤルアップ回線のサイト リンクは、(電話料金の低額な) ピーク時間外に利用し、料金の高い通常の営業時間には利用しないようにスケジュール設定することができます。

    **注意** : SMTP トランスポートを使用するサイト リンクの場合、スケジュール情報は無視されます。メールは蓄積され、メール基盤にサイト リンクが構成された時点で交換されます。

-   コスト。リンクを介した通信と関連付けられた単独の数値コスト ファクタです。コスト値が増えるほど、高額なメッセージになることを意味します。たとえば、低速なダイヤルアップ接続によって接続されたサイトは、サイト間のサイト リンクのコストが高くなります。バックボーン回線によって適切に接続されたサイトは、サイト リンクのコストが低くなります。2 つのサイト間に複数のルートやトランスポートが存在する場合、最も低額なルートとトランスポートが使用されます。

-   複製間隔。複製の発生する頻度を分単位で指定できます (既定は 180 分 (3時間))。最小の間隔は 15 分間です。

サイト リンクを設定することで、複製のトポロジとタイミングを個別に制御できます。

-   サイト リンクでコストを設定すると、トポロジが制御されます。一般的なシナリオでは、バックボーン ネットワークに属するサイト リンクのコストを 1 に設定し、支社への低速な接続に対応するサイト リンクのコストを 100 に設定します。この方法でコストを設定すると、バックボーンに属するサイト内のドメイン コントローラへ、確実に支社を複製することができます。別の支社に直接複製されることはありません。コスト数値は、複製間隔に影響を与えません。

-   サイト リンクに分単位の間隔を設定することで、複製間隔を制御することができます。

-   サイト リンク上にスケジュールを設定することで、リンクの可用性が制御されます。ほとんどのリンクで既定のスケジュール (100 % の可用性) を使用しますが、業務の繁忙な時間帯は、特定の支社へのリンクの複製トラフィックを遮断します。複製を遮断することで、別のトラフィックに優先順位が与えられますが、複製の待ち時間も増加します。

#### サイト リンクの作成

2 つ以上のサイト間のサイト リンクを作成することで、複製トポロジに影響を与えることができます。サイト リンクを作成すると、利用可能な接続、優先順位、および利用可能な帯域幅に関する情報を Active Directory に提供することが可能です。Active Directory はこの情報を使用して、複製時に最適なパフォーマンスを提供する時間帯と接続を選択します。

**警告** : SMTP を使用するサイト リンクを作成する場合は、利用可能なエンタプライズ証明機関 (エンタプライズ CA) があり、サイト リンクを使用するすべてのドメイン コントローラに SMTP がインストールされている必要があります。

**サイト リンクを作成するには**

1.  **\[スタート\]** をクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。

2.  コンソール ツリーで、使用するサイト リンクのサイト間トランスポート プロトコルを右クリックし、**\[新しいサイト リンク\]** をクリックします。

3.  **\[名前\]** に、リンクに付ける名前を入力します。

4.  接続する 2 つ以上のサイトをクリックし、**\[追加\]** をクリックします。

5.  サイト リンクのコスト、スケジュール、複製の間隔を設定します。

**サイト リンクを削除するには**

1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。

2.  コンソール ツリーで、サイトを追加するサイト リンクの含まれたサイト間トランスポート フォルダをクリックします。

3.  詳細ウィンドウで、サイトを追加するサイト リンクを右クリックし、**\[プロパティ\]** をクリックします。

4.  このサイト リンクに追加するサイトをクリックし、**\[追加\]** をクリックします。

**サイト リンクを削除するには**

1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。

2.  コンソール ツリーで、削除するサイト リンクが含まれているサイト間トランスポート フォルダをクリックします。

3.  詳細ウィンドウで、削除するサイト リンクを右クリックし、**\[削除\]** をクリックします。

**コスト ファクタ**

コスト値をサイト リンクに割り当てると、高コストの接続よりも低コストな接続が優先されます。帯域幅の提供コストは、サイト範囲を定義するときに考慮されるファクタです。このようなコストはサイト全体で定義することをお勧めします。通常、コストは、リンクの総帯域幅に限らず、リンクの可用性、待ち時間、金銭的コストに基づいています。

たとえば、ダイヤルアップの 128 Kbps のデュアル ISDN リンクよりも低コストな 128 Kbps の固定リンクが割り当てられます。その理由は、ダイヤルアップ ISDN リンクでは、リンクの確立や削除のときに、複製待ち時間による遅れが生じるためです。さらに、この例では、固定リンクは月あたりの費用は定額制ですが、一方の ISDN 回線は実際の使用量に応じて課金されます。企業が固定リンクに先行投資している場合、ISDN リンクよりも低いコストを固定リンクに割り当てます。この例の ISDN 接続は、固定リンクに事前に支払った費用以外に、余分な金銭的コストを費やすだけにすぎません。

下表は、さまざまな種類のネットワーク速度を示しています。このネットワーク速度を参考に、コストを見積もることができます

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th style="border:1px solid black;" >ネットワークの種類</th>
<th style="border:1px solid black;" >速度</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="border:1px solid black;">低速 (通常、欧州で利用)</td>
<td style="border:1px solid black;">64 Kbps</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">ISDN</td>
<td style="border:1px solid black;">64 Kbps または 128 Kbps</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">フレーム リレー</td>
<td style="border:1px solid black;">通常、56 Kbps ～ 1.5 Mbps 間で変化</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">T1</td>
<td style="border:1px solid black;">1.5 Mbps</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">T3</td>
<td style="border:1px solid black;">45 Mbps</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">非同期転送モード (ATM)</td>
<td style="border:1px solid black;">通常、155 Mbps ～ 622 Mbps 間で変化</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">ギガビット イーサネット</td>
<td style="border:1px solid black;">1 Gbps</td>
</tr>
</tbody>
</table>
  
任意のコストを割り当てる前に、WAN のモデルを定義します。コストに加え、それ以外のファクタ (可用性と複製の待ち時間) を基準に、フォレスト全体で実行できる一連のコストを確立します。この場合、コストを割り当てることで、同じコストが割り当てられた別の場所にも同じ内容が常に適用されることになります。下表は、フォレスト内のネットワークごとにコストを分類した一例を示しています。この場合、高速なネットワークが低コストになります。

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th style="border:1px solid black;" >ネットワークの種類</th>
<th style="border:1px solid black;" >コスト値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="border:1px solid black;">バックボーン接続の T1</td>
<td style="border:1px solid black;">1</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">56 キロビット リンク</td>
<td style="border:1px solid black;">500</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">支社</td>
<td style="border:1px solid black;">1,000</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">国際的なリンク</td>
<td style="border:1px solid black;">5,000</td>
</tr>
</tbody>
</table>
  
サイト リンクの**コスト**設定によって、リンクに属するすべてのサイト間の通信コストの相対値が提供されます (既定でサイト リンク設定は接続するサイト間で*推移的*です)。たとえば、IP サイト リンクのオブジェクト XYZ を作成し、X、Y、Z のサイトをコスト 5 で接続した場合、サイトのすべてのペア (X から Y、X から Z、Y から X、Y から Z、Z から X、Z から Y) の間で、IP メッセージをコスト 5 で送信できるようなリンクが確立されます。
  
**注意** : 既定ではすべてのサイト リンクは推移的です。すなわち、指定されたトランスポートのサイト リンクすべてが、黙示的にそのトランスポート用の単独のサイト リンク ブリッジに属します。IP ネットワークが完全にルートされていない場合、IP トランスポートの推移的なサイト リンク機能をオフにすることができます。この場合、すべての IP サイト リンクが非推移的であると見なして、サイト リンク ブリッジが構成されます。
  
KCC は、ディレクトリ パーティションごとに、各サイトから他のすべてのサイトへの最も低コストな経路を決定します。次に、すべての宛先に対する複数の入出力経路を再度比較し、最も低コストな経路のスパン ツリーを算出します。
  
**サイト リンクのコストを構成するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、構成するリンクの種類が含まれているサイト間トランスポート フォルダをクリックします。
  
3.  詳細ウィンドウで、コストを設定するサイト リンクを右クリックし、**\[プロパティ\]** をクリックします。
  
4.  **\[コスト\]** に、複製のコストの値を入力します。
  
**注意** : コストは、1 つのサイト リンク ブリッジを構成する構成要素リンクのコストの合計によって決まるため、コストをサイト リンク ブリッジに適用することはできません。コストはサイト リンクにのみ適用できます。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### サイト リンク ブリッジ
  
サイト リンク ブリッジ オブジェクトは、一連のサイト リンクを表しており、ここに属するすべてのサイトは、何らかのトランスポート経由で通信できます。通常、サイト リンク ブリッジは、IP ネットワーク内のルーター (またはルーター一式) に相当します。
  
**注意** : サイト リンク ブリッジのトランスポートが可能なブリッジヘッド サーバーが、リンクされた 2 つのサイトに存在しない場合、ルーターは利用できません。
  
既定では、作成されたすべてのサイト リンクがブリッジされます (推移的)。特定のトランスポートに対するすべてのサイト リンクは、黙示的にそのトランスポートの単一のサイト リンク ブリッジに属します。したがって、完全にルートされた IP ネットワークの場合、一般的に、サイト リンク ブリッジを構成する必要がありません。下図は、3 つのサイトが 2 つのサイト リンクによって接続されている状態を示しています。この場合、明示的なサイト リンクによって接続されていない 2 つのサイト間で、サイト リンク ブリッジにより接続の作成が可能になります。
  
![](images/Dd363001.w2kab201(ja-jp,TechNet.10).gif)
  
IP ネットワークが完全にルートされていない場合、(IP トランスポート オブジェクトのプロパティ シートまたは SMTP トランスポート オブジェクトのプロパティ シートの **\[全般\]** タブから) IP トランスポートの **\[サイト リンクをすべてブリッジ\]** をオフにすることができます。オフにした場合、すべての IP サイト リンクが非推移的であると見なされ、ネットワークの実際のルーティング動作をモデル化して、サイト リンク ブリッジが構成されます。
  
#### サイト リンク ブリッジの管理
  
特定のトランスポートに、2 つ以上のサイト リンクを指定することで、指定されたトランスポート用のサイト リンク ブリッジ オブジェクトを作成することができます。
  
サイト リンク ブリッジの意味を理解するために、以下の例を検討します。
  
-   サイト リンク SM はシアトルとミラノのサイトをコスト 4 の IP 経由で接続する。
  
-   サイト リンク SA はシアトルとアトランタのサイトをコスト 3 の IP 経由で接続する。
  
-   ミラノとアトランタのサイト間にはサイト リンクがない。
  
-   サイト リンク ブリッジ SM-SA は、サイト リンク SM と SA を接続する。
  
-   この単純な例では、サイト リンク ブリッジ SM-SA によってミラノからアトランタのサイトへ、 4 + 3＝7 のコストで IP メッセージが送信できることを意味する。
  
ブリッジ内の各サイト リンクは、そのブリッジ内の別のサイト リンクと共通するサイトを、少なくとも 1 つ持っていなければなりません。持っていない場合、ブリッジは、そのブリッジに属しているあるリンク内のサイトから他のリンク内のサイトまでのコストを計算することができません。たとえば、4 つのサイト (W、X、Y、Z) があり、さらに W と X を接続するサイト リンク WX、Y と Z を接続するサイト リンク YZ がある場合、WX と YZ を接続するサイト リンク ブリッジは用途を成しません。
  
同一トランスポートに対するものでも、独立したサイト リンク ブリッジは相互に依存しません。このような独立性を表すには、ミラノ－シアトル－アトランタの例に以下のオブジェクトを追加します。
  
-   サイト リンク DA はデトロイトとアトランタのサイトをコスト 2 の IP 経由で接続する。
  
-   サイト リンク ブリッジ DA-SA は、サイト リンク DA と SA を接続する。
  
このようにブリッジを追加することで、シアトルからデトロイトのサイトへ、コスト 2 + 3 = 5 で IP メッセージを送信できることになります。ただしこれは、デトロイトからミラノのサイトへ、コスト 2 + 3 + 4 = 9 で IP メッセージを送信できることを意味するものではありません。ほとんどの場合、単一のサイト リンク ブリッジを使用して、IP ネットワーク全体をモデル化します。
  
**サイト リンク ブリッジを作成するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、新しいサイト リンク ブリッジを作成するサイト間トランスポート フォルダを右クリックし、**\[新しいサイト リンク ブリッジ\]** をクリックします。
  
3.  **\[名前\]** に新しいサイト リンク ブリッジの名前を入力します。
  
4.  ブリッジする 2 つ以上のサイト リンクをクリックし、**\[追加\]** をクリックします。
  
**注意**
  
\[サイト リンクをすべてブリッジ\] が有効になっている場合、この手順は余分で、なにも効力がありません。
  
複数のサイト間にサイト リンクを作成した場合も複製トポロジに反映されます。サイト リンクを作成すると、利用可能な接続、優先する接続、および利用可能な帯域幅に関する情報が Active Directory に提供されます。Active Directory はこの情報に基づき、最高のパフォーマンスが得られる複製の時間と接続を選びます。
  
**サイト リンクをすべてブリッジするには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  **Sites** フォルダをダブルクリックし、**Inter-Site Transports** フォルダをダブルクリックします。
  
3.  該当するサイト間トランスポート フォルダ (**IP** または **SMTP** など) を右クリックし、**\[プロパティ\]** をクリックします。
  
4.  **\[サイト リンクをすべてブリッジ\]** チェック ボックスをオンにします。
  
**注意** : すべてのサイト リンクをブリッジするとファイアウォールをまたがるサイト間の接続が作成される場合で、ファイアウォールが特定のドメイン コントローラ間でやり取りされるパケットしか許可しない場合は、複製エラーが発生します。
  
**サイト リンク ブリッジを削除するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、削除するサイト リンク ブリッジが含まれているサイト間トランスポート フォルダをクリックします。
  
3.  詳細ウィンドウで、削除するサイト リンク ブリッジを右クリックし、**\[削除\]** をクリックします。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 複製間隔
  
サイト リンク オブジェクトごとに、複製間隔の値を指定することができます。これにより、スケジュールで許可された期間に、サイト リンク間でどれだけの頻度で複製が発生するか決まります。たとえば、スケジュールによって午前 2 時から 4 時の間、複製が許可されており、複製間隔が 30 分に設定されている場合、スケジュールの時間内に最大 4 回複製が発生します。
  
既定の複製間隔は、180 分 (3 時間) です。KCC によって、あるサイトのドメイン コントローラと別のサイトのドメイン コントローラ間の接続を作成するときは、サイト リンク オブジェクトの最小コスト経路をたどって両端が接続されるので、接続の複製間隔は最大にします。
  
#### サイト リンク設定と複製待ち時間
  
スケジュールは、サイト リンクを利用できる期間を決定し、複製間隔はその期間に発生する複製の頻度を決定します。この要素の相互作用によって、複製の待ち時間が決まります。サイト内の最大の複製間隔が 15 分のサイトでは、最悪の場合、ソースのドメイン コントローラから、宛先となるリモート サイト内のドメイン コントローラまでの複製待ち時間は、ソースと宛先のサイト間の接続に設定された複製間隔の合計に、経路内の各サイト (ソースと宛先のサイトを含む) に対する 15 分を加えたものになります。これは、RPC トランスポートをサイト間で使用しており、必要な物理接続を利用できることを前提とした場合の合計です。
  
**スケジュールと複製間隔の相互作用**
  
複数のサイト リンクですべてのサイトの複製を完了する必要があるとき、各リンクの複製間隔が合計されるため、サイト間の接続の全体的な長さに影響します。また、各リンクのスケジュールが一致していない場合、スケジュールが交わる期間のみ複製が発生します。
  
サイト A とサイト B がサイト リンク AB を所有し、サイト B とサイト C がサイト リンク BC を所有する場合について考えます。サイト A のドメイン コントローラを、サイト C のドメイン コントローラに複製するときは、サイト リンク AB とサイト リンク BC に許可された最大の間隔でのみ複製が発生します。下表は、サイト A、サイト B、およびサイト C のドメイン コントローラ間で複製を発生する頻度と期間を決定するサイト リンク設定を示しています。

 
<table style="border:1px solid black;">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th style="border:1px solid black;" >サイト リンク</th>
<th style="border:1px solid black;" >複製間隔</th>
<th style="border:1px solid black;" >スケジュール</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="border:1px solid black;">AB</td>
<td style="border:1px solid black;">30 分</td>
<td style="border:1px solid black;">午後 12 時から午前 4 時</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">BC</td>
<td style="border:1px solid black;">60 分</td>
<td style="border:1px solid black;">午前 1 時から 5 時</td>
</tr>
</tbody>
</table>
  
表 6.4 の設定の場合、サイト リンク AB のスケジュールと間隔 (午後 12 時から午前 4 時まで 30 分間隔) に基づいて、ドメイン A のドメイン コントローラをサイト B のドメイン コントローラと複製できます。ただし、サイト リンク AC が存在しないことを前提とした場合、60 分 (2 つの複製間隔のうち値の大きい方) ごとに、午前 1 時から 4 時 (2 つのサイト リンクのスケジュールが交わる期間) まで、サイト A のドメイン コントローラをサイト C のドメイン コントローラに複製できます。
  
**サイト リンク複製の可用性を構成するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、スケジュールを調整するサイト リンクが含まれているサイト間トランスポートをクリックします。
  
3.  詳細ウィンドウで、スケジュールを調整するサイト リンクを右クリックし、**\[プロパティ\]** をクリックします。
  
4.  **\[スケジュールの変更\]** をクリックします。
  
5.  スケジュールを設定する時間帯を選択し、その時間帯の複製の回数を、**\[なし\]**、**\[1 時間に 1 回\]**、**\[1 時間に 2 回\]**、**\[1 時間に 4 回\]** の中から選択してクリックします。
  
    **注意** : SMTP は非同期なので、通常、すべてのスケジュールを無視します。したがって、サイト リンクがスケジュールされた接続を使っている場合、または SMTP キューがスケジュールされておらず、ネットワーク イーサネット バックボーンのような仲介装置を経由することなく、情報が一方のサーバーともう一方のサーバー間で直接やり取りされている場合を除いて、SMTP サイト リンクに対してサイト リンク複製の可用性を構成しないでください。
  
**サイト リンクの複製間隔を構成するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、構成するサイト リンクが含まれているサイト間トランスポートをクリックします。
  
3.  詳細ウィンドウで、複製間隔を設定するサイト リンクを右クリックし、**\[プロパティ\]** をクリックします。
  
4.  **\[複製の間隔\]** に、複製の間隔を分単位で入力します。
  
    **注意** : **\[複製の間隔\]** の値は、最短 15 分から最長 10,080 分 (1 週間) の範囲で、15 の倍数に最も近い値として処理されます。
  
**スケジュールを無視するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、スケジュールを無視するサイト リンクが含まれているサイト間トランスポート プロトコルを右クリックし、**\[プロパティ\]** をクリックします。
  
3.  **\[スケジュールを無視\]** チェック ボックスをオンにします。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 変更通知
  
*変更通知*は、複製パートナーに変更があったことをドメイン コントローラによって通知するメカニズムです。サイト内の複製は変更に応じて発生します。あるドメイン コントローラで変更が発生すると、その複製パートナーに通知され、変更を要求するプロンプトが表示されます。ドメイン コントローラは属性の更新を実行すると、指定された期間内に変更に従う旨の通知を複製パートナーへ送信します。
  
**サイト内の変更通知**
  
サイト内で発生した変更の場合、変更が行われてから、ソース サーバーが複製パートナーに通知するまでの期間を決定する「ホールドバック タイマ」があります。時間的に間隔を置くことで、複製を原因とするネットワーク トラフィックをずらす効果があります。ドメイン コントローラがディレクトリ パーティションに変更 (生成または複製) を行うと、タイマが開始されます。タイマの有効期限が経過すると、ドメイン コントローラは変更があったことを (そのディレクトリ パーティションとサイト内の) すべての複製パートナー に通知します。パートナーは、別のパートナーからの変更要求に関わっていない場合、通知したサーバーに変更要求を送信します。
  
ホールドバック タイマの既定値は、300 秒 (5 分) です。既定のレジストリ設定を変更するには、HKEY\_LOCAL\_MACHINE\\ SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters の **\[Replicator notify pause after modify (secs)\]** エントリに新しい値を設定します。
  
**注意** : このタイマの値をあまりに小さくしすぎると、通知が余分に生成され、パフォーマンスが劣化する可能性があります。
  
ドメイン コントローラは、同時にすべての複製パートナーに通知することはありません。通知の時間を遅らせることで、パートナーからの複製要求に応答する際の負荷を分散します。既定では、30 秒ごとに通知を遅らせます。
  
既定の遅れを変更するには、HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters の **\[Replicator notify pause between DSAs (secs)\]** に新しい値を設定します。
  
**Warning** : レジストリを直接編集すると、システムが起動できない、あるいは Windows 2000 の再インストールが必要となるような、予期しない重大な問題が生じるおそれがあります。\[コントロール パネル\] または Microsoft 管理コンソール (MMC) で利用できるプログラムによって、ほとんどの管理タスクは実行できます。このようなプログラムでは、競合する設定や、パフォーマンスの劣化やシステム障害を招く設定をユーザーが行わないような対策が施されています。レジストリ エディタは、管理ツールによって提供される標準的な安全措置を介しません。レジストリの変更は、管理ツールが利用できない場合にのみ行うようにしてください。またレジストリを変更する前に、コンピュータ上の貴重なデータをバックアップすることをお勧めします。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 緊急複製
  
緊急複製は、ソースのドメイン コントローラで変更が発生したことを RPC/IP 経由で直ちに複製パートナーに通知することで実行されます。緊急複製の場合、他の方法で変更通知を使用している宛先とソースのドメイン コントローラ間で、通常の変更通知を使用しますが、既定の 5 分間を待機する代わりに、緊急のイベントに応答して、直ちに通知を送信します。したがって、変更通知がサイト リンクで有効な場合、複製をトリガするイベントによって、サイト間の緊急複製が実行されます。
  
**緊急複製をトリガするイベント**
  
Active Directory の緊急複製は、同一サイト内のすべてのドメイン コントローラでの特定のイベントによって常にトリガされます。変更通知がサイト間で有効になると、トリガとなるイベントもサイト間の複製を直ちに実行します。
  
同一サイト内の Windows 2000 ベースのドメイン コントローラ間での即時複製は、以下の場合に要求されます。
  
-   アカウントのロックアウトの割り当て。一定の回数ログオンに失敗したユーザーのログオンを禁止します。
  
-   ローカル セキュリティ期間 (LSA) のシークレットの変更。LSA によってプライベート データを格納する安全な方法です。
  
-   相対識別子 (RID) のマスタ役割所有者の変更。これは、そのドメインのすべてのドメイン コントローラに相対識別子を割り当てる、ドメイン内の単一のドメイン コントローラです。
  
**アカウント ロックアウト変更の緊急複製**
  
アカウントのロックアウトは、失敗できる認証試行回数の制限を設定し、この回数を超えてログオンを試みるアカウントをロックアウトするほか、ロックアウトの有効期間を設定するセキュリティ機能です。
  
Windows 2000 では、アカウントのロックアウトが、プライマリ ドメイン コントローラ (PDC) エミュレータ役割の所有者へ、さらに以下のドメイン コントローラへと緊急に複製されます。
  
-   PDC エミュレータと同じサイトに位置する同じドメイン内のドメイン コントローラ
  
-   アカウント ロックアウトを処理したドメイン コントローラと同じサイトに位置する同じドメイン内のドメイン コントローラ
  
-   (緊急複製される) PDC エミュレータを含むサイトまたはアカウント ロックアウトを処理したサイトへの、サイト間の変更通知を許可するよう構成されたサイトに位置する同じドメイン内のドメイン コントローラ。このようなサイトとして、PDC エミュレータを含むサイトと同じサイト リンク、またはアカウント ロックアウトを処理したドメイン コントローラを含むサイトと同じサイト リンクに含まれたサイトがあります。
  
また、PDC エミュレータ以外のドメイン コントローラで認証に失敗すると、PDC エミュレータで認証が再試行されます。そのため、間違ったパスワード回数のしきい値に到達する場合、失敗したパスワードの試行を処理したドメイン コントローラより前に、PDC エミュレータがアカウントをロックアウトします。
  
**緊急複製の管理**
  
緊急複製の達成と関連して、サイト間の変更通知をいつ有効にするか決定するには、以下のガイドラインが役立ちます。
  
-   あらゆる場所に緊急複製する場合、単一のサイトの特定のドメインのすべてのドメイン コントローラに適用する (このオプションは現実的ではありません)。
  
-   あらゆる場所に緊急複製するが、サイトの類似性のメリットも必要な場合、複数のサイトを使用して、すべてのサイト リンクで変更通知を有効にする。
  
-   既定では、ユーザーのロックアウトによって、認証を処理したドメイン コントローラを含むサイトと、PDC エミュレータ役割の所有者を含むサイトで緊急複製を要求する。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### 2 台のサーバー間の強制的な複製
  
接続オブジェクトを使用して、入力方向のサーバーから複製を強制することができます。\[Active Directory サイトとサービス\] で、接続オブジェクトを右クリックし、**\[今すぐ複製\]** をクリックします。
  
**パスワード変更の複製**
  
パスワードの変更は、通常 (緊急以外) と緊急では異なる方法で複製されます。セキュリティ アカウント パスワードを変更すると、複製遅れの問題が生じます。それは、ドメイン コントローラ A でユーザー パスワードが変更された後に、ログオンを試みたユーザーが、ドメイン コントローラ B によって認証される場合です。パスワードが A から B に複製されていない場合、ログオンは失敗します。Active Directory の複製は、パスワードの変更をそのドメインの単一のドメイン コントローラ、すなわち PDC エミュレータへ即座に転送することで、この状況に対処します。
  
Windows 2000 では、特定のドメイン コントローラでユーザー パスワードが変更されると、そのドメイン コントローラは、PDC エミュレータ役割を有するドメイン コントローラでそれぞれの複製を更新します。PDC エミュレータの更新は、サイト リンク上のサイト間のスケジュールに関係なく、即座に発生します。更新されたパスワードは、サイト内の通常の複製によって別のドメイン コントローラへ伝達されます。 ドメインにログオンしたユーザーを、パスワードが更新されていないドメイン コントローラが認証する場合、そのドメイン コントローラは、無効なパスワードに基づいて認証を拒否せずに、PDC エミュレータを参照し、ユーザー名とパスワードの資格情報を確認します。したがって、認証する側のドメイン コントローラが、更新されたパスワードをまだ受信していなくても、ユーザーは問題なくログオンできます。
  
何らかの理由で PDC エミュレータでの更新に失敗した場合、パスワードの変更は緊急ではない通常の方法で複製されます。
  
**注意** : PDC エミュレータ役割の所有者が現在のサイトにいない場合、PDC エミュレータと接触しないようドメイン コントローラを設定できます。HKEY\_LOCAL\_MACHINE\\CurrentControlSet\\Services\\Netlogon \\Parameters\\ の **\[AvoidPdcOnWan\]** エントリが 1 に設定されている場合、パスワードの変更は、緊急ではなく通常の複製を通じて PDC エミュレータへ到達します。
  
**接続を手動で追加または構成するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、接続を手動で追加または構成するドメイン コントローラをクリックします。
  
3.  **\[NTDS Settings\]** を右クリックし、**\[新しい Active Directory 接続\]** をクリックします。
  
4.  **\[ドメイン コントローラを検索します\]** ダイアログ ボックスで、接続オブジェクトに含めるドメイン コントローラをクリックします。
  
5.  **\[新しいオブジェクト - 接続\]** ダイアログ ボックスで、新しい接続オブジェクトの名前を入力します。
  
**接続を経由する複製を強制するには**
  
1.  次の手順で Active Directory サイトとサービスを開きます。**\[スタート\]** ボタンをクリックし、**\[プログラム\]** をポイントします。次に、**\[管理ツール\]** をポイントし、**\[Active Directory サイトとサービス\]** をクリックします。
  
2.  コンソール ツリーで、ディレクトリ情報を複製するときに経由する接続が含まれたサイトのドメイン コントローラをダブルクリックします。
  
3.  コンソール ツリーで、**\[NTDS Settings\]** をクリックします。
  
4.  詳細ウィンドウで、ディレクトリ情報を複製するときに経由する接続を右クリックし、**\[今すぐ複製\]** をクリックします。
  
[](#mainsection)[ページのトップへ](#mainsection)
  
### Active Directory コネクタの既定の複製時間の変更
  
**\[常に\]** 設定が選択されている場合、Active Directory コネクタ (ADC) 接続許可書に複製のスケジュールが設定され、5 分ごとに複製が発生します。 複製の発生する頻度を増やすには、Windws のレジストリを変更して、ADC にパラメータを追加します。
  
**警告** レジストリ エディタを使用すると、場合によってオペレーティング システムの再インストールが必要となる重大な問題が発生するおそれがあります。レジストリ エディタの不適切な使用によって生じた問題の解決に関して、マイクロソフトは一切保証を負いません。
  
**ADC にパラメータを追加して、複製の発生頻度を増やすには**
  
1.  レジストリ エディタを起動します (Regedt32.exe)。
  
2.  レジストリの以下のキーへ移動します。
  
    HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MSADC\\Parameters
  
3.  \[編集\] メニューで、**\[値の追加\]** をクリックし、次のレジストリ値を追加します。
  
    **値の名前** : Sync Sleep Delay (secs)
  
    **データ**の種類: REG\_DWORD
  
    **値** : 5
  
4.  レジストリ エディタを終了します。
  
[](#mainsection)[ページのトップへ](#mainsection)
