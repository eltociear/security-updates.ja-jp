---
TOCTitle: ISA サーバー上の Web サーバーの公開
Title: ISA サーバー上の Web サーバーの公開
ms:assetid: 'bc59113d-fc75-4793-aec4-c635ab0ba2ad'
ms:contentKeyID: 19869635
ms:mtpsurl: 'https://technet.microsoft.com/ja-jp/library/Cc751014(v=TechNet.10)'
---

ISA サーバー上の Web サーバーの公開
===================================

最終更新日: 2003年7月7日

**Microsoft ISA Server 2000 Feature Pack 1 バージョン 1**

このシナリオでは、ISA Server およびインターネットインフォメーションサービス (IIS) の両方を 1 台のコンピュータでホストします。Web 公開ルールを使用して Web サイトをインターネットに公開します。Web サーバーでは、HTTP 要求と HTTPS 要求の両方を扱うことができます。

##### トピック

[](#eeaa)[ハードウェア要件](#eeaa)  

[](#edaa)[ソフトウェア要件](#edaa)  

[](#ecaa)[作業を始める前に](#ecaa)  

[](#ebaa)[手順](#ebaa)  

[](#eaaa)[オリジナルのホストヘッダー](#eaaa)  

### ハードウェア要件

ISA Server コンピュータの Web サーバーを公開するには、2 つのネットワークアダプタを備えた 1 台のコンピュータが必要です。コンピュータは、ISA Server コンピュータおよび Web サーバーの両方として使用します。1 つのネットワークアダプタはインターネットに、もう 1 つは内部ネットワークに接続されます。セットアップをテストするには、ネットワークの外部に配置され、インターネットに接続されているコンピュータが必要です。

[](#mainsection)[ページのトップへ](#mainsection)

### ソフトウェア要件

ISA Server コンピュータには、Microsoft Windows 2000 Server、Windows 2000 Advanced Server、または Windows Server 2003 と Service Pack 1 が適用された ISA Server のいずれかがインストールされている必要があります。Web サイトの公開に使用するインターネットインフォメーションサービス (IIS) は、Windows 2000 Server、Windows 2000 Advanced Server、および Windows Server 2003 に含まれています。

**注意** SSL でセキュリティ保護された Web ページを公開する予定がある場合は、ISA Server コンピュータに SSL 証明書をインストールする必要があります。詳細については、この文書の「SSL 公開用のブリッジの構成」および Digital\_Certificates\_for\_ISA.doc を参照してください。

[](#mainsection)[ページのトップへ](#mainsection)

### 作業を始める前に

短時間で構成するために、次の情報をあらかじめ準備しておいてください。

-   ISA Server コンピュータの内部および外部ネットワークアダプタの IP アドレス


また、パブリックインターネット DNS サーバーにより、Web サイトのパブリック名が ISA Server の外部 IP アドレスにマップされていることを確認します。

**注意** これらの作業を行うには、管理者特権が必要です。

[](#mainsection)[ページのトップへ](#mainsection)

### 手順

ISA Server 上の Web サーバーを公開する手順は次のとおりです。

**手順 1. IIS を使用して Web サイトを作成する**

詳細については、IIS のマニュアルを参照してください。Web サイトの場所に注意してください。サイトが既定の Web サイトでない場合は、Web 公開ルールを作成するときに正確なパスを指定する必要があります。

**手順 2. DNS を構成する**

ISA Server は、外部ネットワークアダプタのポート 80 で着信方向の Web 要求をリッスンし、ポート 443 で着信方向の SSL 要求をリッスンします。また、既定では、IIS は着信方向の Web 要求をすべてのアダプタのポート 80 でリッスンし、着信方向の SSL 要求をポート 443 でリッスンします。このポートの競合を避けるために、ポート 80 以外のポート (ポート 8888 など) でリッスンし、ポート 443 以外のポート (ポート 4444 など) で SSL 要求をリッスンするように IIS を構成します。これらのポート番号は、後で Web 公開ルールを構成するときに必要になるので、メモしておくことをお勧めします。また、コンピュータの内部ネットワークアダプタの IP アドレスで着信方向の Web 要求のみをリッスンするように IIS を構成する必要があります。そうしないと、IIS により、ISA Server を経由せずに外部リスニングポートが公開されます。

**IIS を構成するには**

1.  インターネットサービスマネージャを開き、サーバーノードを展開します。

2.  \[既定の Web サイト\] ノードを右クリックし、\[プロパティ\] をクリックします。

3.  \[Web サイト\] タブで、次の操作を行います。

    -   内部ネットワークアダプタのアドレスを反映するように IP アドレスを変更します。

    -   TCP ポートを、80 以外で 1024 より大きい番号に変更します。

    -   (SSL 公開の場合は省略可) SSL ポートを 443 以外で 1024 より大きい番号に変更します。このフィールドは、コンピュータに SSL 証明書がインストールされている場合にのみ有効です。

  
4.  \[OK\] をクリックし、インターネットインフォメーションサービスを再起動します。
  

**手順 3. 宛先セットを作成する**

宛先セットを作成する前に、宛先セットと宛先セットのパスについて理解しておく必要があります。

**宛先セットについて**

Web 公開用の宛先セットは、外部ユーザーが Web サイトにアクセスするときに指定する www.adatum.com などのパブリック名です。Web 公開シナリオでは、Web サーバーは外部から直接アクセスできないように保護されています。外部の要求に対しては ISA Server のみが公開されます。宛先セットは、Web サイトへの要求があった場合、DNS サーバーで名前が解決されるときに ISA Server を見つけられるように、ISA Server の外部ネットワークアダプタを表しています。宛先セットに指定されたホスト名は、インターネット上の DNS サーバーにより、ISA Server コンピュータの外部ネットワークアダプタの IP アドレスとして解決される必要があります。

**宛先セットのパスについて**

パスを指定する複数の宛先セットを作成できます。たとえば、1 つのホスト名に対して、パス /update\* (/update/ およびこのパスに含まれるすべてのパスに対する任意の要求) と /info\* を指定できます。これらの宛先セットは、両方とも同じ ISA Server の外部ネットワークアダプタの IP アドレスとして解決されます。宛先セットのパスを使用して、要求を別の Web サーバーや、特定の Web サーバーの別のディレクトリに送信するための Web 公開ルールを作成できます。各ルールでは、ユーザーの要求で指定されたパスに応じて HTTP アクセスや SSL アクセスを許可するなどの、さまざまな条件を使用できます。

**宛先セットの例**

ユーザーが「http://www.adatum.com/info」と入力してサイトにアクセスしようとした場合、ISA を介してサイトを公開するために使用される宛先セットには、宛先セクションに www.adatum.com が含まれ、宛先セットに指定されたパスとしてパス /info が含まれている必要があります。

**宛先セットを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[宛先セット\] を右クリックし、\[新規作成\] をポイントして、\[セット\] をクリックします。
 
2.  \[名前\] ボックスに、「宛先の内部 Web サーバー」など、宛先セットの名前を入力します。

3.  (省略可) \[説明\] ボックスに宛先セットの説明を入力します。

4.  \[追加\] をクリックし、次の操作を行います。

    -   \[宛先\] をクリックして、外部ユーザーが Web サイトにアクセスするときに指定するパブリック名を入力します。これは、ISA Server コンピュータの外部ネットワークアダプタの IP アドレスとして解決される、完全修飾ドメイン名です。

        ![](images/Cc751014.pwisa01(ja-jp,TechNet.10).gif)

    -   (省略可) \[パス\] ボックスに、要求に含めることができる特定のパスを入力します。このパスを Web 公開ルールで使用して、要求を Web サイトの特定の場所に送信できます。


5.  \[OK\] をクリックします。


**手順 4. 着信方向の Web 要求用の Web リスナを作成する**

Web リスナは、クライアントからの Web 要求をリッスンする ISA Server コンピュータ上の IP アドレスです。ISA Server をインストールすると、既定では、着信方向の Web 要求のプロパティは、IP アドレスが要求をリッスンしないように構成されます。したがって、Web 公開ルールを使用して Web サイトを公開するには、Web リスナを構成する必要があります。着信方向の Web リスナは、ISA Server の外部インターフェイスでポート 80 を使用します。

**着信方向の Web 要求のリスナを構成するには**

1.  \[ISA の管理\] コンソールで、\[サーバーとアレイ\] ノードを展開します。
  
2.  ISA Server コンピュータのノードを右クリックし、\[プロパティ\] をクリックします。
  
3.  \[着信方向の Web 要求\] タブで \[IP アドレスごとにリスナを構成する\] を選択します。
  
4.  (省略可) SSL (HTTPS) 要求をリッスンする場合は、\[SSL リスナを有効にする\] チェックボックスをオンにします。この後の手順で、リスナの SSL 証明書を構成する必要があります。
  
5.  \[追加\] をクリックします。

6. \[サーバー\] の一覧で、着信方向の Web 要求をリッスンするサーバーである ISA Server コンピュータを選択します。

7. \[IP アドレス\] の一覧で、着信方向の Web 要求をリッスンするサーバーのインターネットプロトコル (IP) アドレスをクリックします。これは、インターネットに接続する ISA Server のネットワークアダプタの IP アドレスになります。

8. (省略可) \[表示名\] ボックスに、このリスナに使用する名前を入力します。

9. SSL 要求もリッスンするリスナを構成する場合は、\[Web クライアントの認証にサーバー証明書を使う\] チェックボックスをオンにします。次に、\[選択\] をクリックし、ISA Server コンピュータにインストールされている適切な SSL 証明書を選択します。

10. (省略可) リスナの認証方法を構成します。

11. \[OK\] をクリックして \[リスナの追加/編集\] ページを閉じます。次の図は、リスナを追加後の \[マイアレイのプロパティ\] ページを示しています。

    ![](images/Cc751014.pwisa02(ja-jp,TechNet.10).gif)

12. \[OK\] をクリックして \[マイアレイのプロパティ\] ページを閉じます。

13. メッセージが表示されたら、Web Proxy サービスを再起動します。


**手順 5. Web 公開ルールを作成する**

Web 公開ルールでは、着信した要求を ISA Server コンピュータ上の Web サーバーにマップします。

**Web 公開ルールを作成するには**

1.  \[ISA の管理\] コンソールツリーで、\[Web 公開ルール\] を右クリックし、\[新規作成\] をポイントし、\[ルール\] をクリックして、\[新しい Web 公開ルールウィザード\] を起動します。
  
2.  \[新しい Web 公開ルールウィザードの開始\] ページに、「ローカル Web サーバーの公開ルール」などのルール名を入力し、\[次へ\] をクリックします。

3.  \[宛先セット\] ページで、メニューから \[指定された宛先セット\] を選択します。手順 3 で作成した宛先セットを選択して、\[次へ\] をクリックします。

4.  \[クライアントの種類\] ページで、インターネットからの要求がすべて Web サーバーに届くように、既定のオプション \[すべての要求\] が選択されたままにして、\[次へ\] をクリックします。

5.  \[ルールの動作\] ページで \[要求をこの内部 Web サーバーへリダイレクトする (名前または IP アドレス)\] を選択し、ISA Server の内部 IP アドレスを指定します。

6. \[公開サーバーに送信されたオリジナルのホストヘッダーを、上で指定したサーバーに送信する\] は、既定の、選択されていない状態のままにします。詳細については、この後の「オリジナルのホストヘッダー」を参照してください。\[次へ\] をクリックします。

7. \[要求を HTTP としてブリッジするときにこのポートへ接続する\] ボックスに、Web サーバーを公開するために IIS が使用するポートを入力して、\[次へ\] をクリックします。

8. \[要約\] ページの情報を確認して \[完了\] をクリックします。


**手順 6. SSL 公開用ブリッジを構成する**

セキュリティで保護された SSL 通信が必要なサーバーを公開する場合は、ISA Server コンピュータに SSL 証明書をインストールしておく必要があります。また、Web サーバーにも SSL 証明書をインストールしておく必要があります。いずれの場合も、適切なプロトコルを使用して ISA Server コンピュータから Web サーバーに SSL 要求が送信されるようにするため、必要に応じて SSL ブリッジを構成しなければなりません。

SSL ブリッジは、各 Web 公開ルールのプロパティです。SSL ブリッジでは、ISA Server コンピュータで受信された SSL 要求が Web サーバーに SSL 要求と HTTP 要求のどちらとして渡されるかが、次のような方法で決定されます。

-   Web サーバーに SSL 証明書がインストールされていない場合、SSL および HTTP 要求は Web サーバーに HTTP 要求として渡されます。SSL で保護された通信は ISA Server により処理され、内部では HTTP として扱われます。

-   Web サーバーに SSL 証明書がインストールされている場合、SSL 要求は SSL 要求として、HTTP 要求は HTTP 要求として、内部 Web サーバーに渡されます。この場合、SSL で保護された通信は、クライアント ISA と ISA Web サーバーレベルの両方で行われます。


**Web サーバーが ISA Server 上に配置されている場合は、1 つの証明書が ISA Server に関連付けられます。この場合に SSL ブリッジの構成を変更するには**

1.  \[Web 公開ルール\] ノードをクリックします。
  
2.  適切な Web 公開ルールをダブルクリックします。
  
3.  \[ブリッジ\] タブをクリックします。
  
4.  \[HTTP 要求のリダイレクト\] で \[HTTP 要求として処理\] を選択します。
  
5.  \[SSL 要求のリダイレクト\] で \[HTTP 要求として処理\] を選択します。この構成を次の図に示します。

    ![](images/Cc751014.pwisa03(ja-jp,TechNet.10).gif)

6. \[OK\] をクリックします。


**手順 7. Web ページをテストする**

外部コンピュータでインターネットブラウザを開きます。ブラウザのアドレスフィールドに、Web サイトの URL、または Web サーバーのパブリック IP アドレスを入力します。Web ページが読み込まれた場合は、公開のセットアップは正しく構成されています。Web サイトを表示できない場合は、これまでのすべての手順に従っていることを確認します。それでも Web サイトを表示できない場合は、Troubleshooting\_Web\_Publishing.doc を参照してください。

[](#mainsection)[ページのトップへ](#mainsection)

### オリジナルのホストヘッダー

ISA Server では、既定で、内部 Web サーバーの参照に使用されるホストヘッダーが置き換えられ、受信されたオリジナルのホストヘッダーはそのまま送信されません。Web サイトでオリジナルのホストヘッダーを必要とする特別な機能を使用する場合や、ホスト名が異なる 2 つの Web サイトを公開する場合は、\[新しい Web 公開ルールウィザード\] の \[ルールの動作\] ページで \[公開サーバーに送信されたオリジナルのホストヘッダーを、上で指定したサーバーに送信する\] チェックボックスをオンにします。または、2 つの Web サイトを表す 2 つの宛先セットを作成し、要求を適切なサイトに送信する Web 公開ルールを使用することもできます。

例として示した企業、組織、製品、ドメイン名、電子メールアドレス、ロゴ、人、場所およびイベントはすべて架空の存在です。実在の企業、組織、製品、ドメイン名、電子メールアドレス、ロゴ、人、場所、またはイベントとの関連性を意図したり、暗示することはありません。

[](#mainsection)[ページのトップへ](#mainsection)
